class ThemeLoader{static DEFAULT_THEME="win11";constructor(){this.siteConfig=null,this.currentTheme=ThemeLoader.DEFAULT_THEME,this.loadingComplete=!1}async initialize(){try{await this.waitForSiteConfig(),this.loadThemeFromConfig(),this.loadThemeCSS(),this.applyThemeClass(),this.loadingComplete=!0,this.triggerThemeLoadedEvent()}catch(e){this.fallbackToDefaultTheme()}}async waitForSiteConfig(){if(!window.siteConfigLoaded||"function"!=typeof window.siteConfigLoaded.then)return new Promise((e,t)=>{const i=()=>{window.siteConfig&&(this.siteConfig=window.siteConfig,window.removeEventListener("site.config.loaded",i),e())};window.addEventListener("site.config.loaded",i);let n=0;const s=()=>{n++,window.siteConfig&&window.siteConfig.loaded?(this.siteConfig=window.siteConfig,window.removeEventListener("site.config.loaded",i),e()):n>=50?(window.removeEventListener("site.config.loaded",i),t(new Error("无法加载site-config.js"))):setTimeout(s,100)};window.siteConfig&&window.siteConfig.loaded?i():s()});try{if(await window.siteConfigLoaded,window.siteConfig)return void(this.siteConfig=window.siteConfig);throw new Error("配置Promise解析但配置对象不存在")}catch(e){throw e}}loadThemeFromConfig(){try{if(this.siteConfig&&"function"==typeof this.siteConfig.getUIStyle){const e=this.siteConfig.getUIStyle().toLowerCase();["win10","win11"].includes(e)?this.currentTheme=e:this.currentTheme=ThemeLoader.DEFAULT_THEME}else if(this.siteConfig&&this.siteConfig.site&&this.siteConfig.site.uiStyle){const e=this.siteConfig.site.uiStyle.toLowerCase();["win10","win11"].includes(e)?this.currentTheme=e:this.currentTheme=ThemeLoader.DEFAULT_THEME}else this.currentTheme=ThemeLoader.DEFAULT_THEME}catch(e){this.currentTheme=ThemeLoader.DEFAULT_THEME}}loadThemeCSS(){this.ensureBaseCSSLoaded(),this.removeExistingThemeCSS();const e=document.createElement("link");e.id="theme-css",e.rel="stylesheet",e.href=`css/${this.currentTheme}.css`,e.async=!1,document.head.appendChild(e),e.onload=()=>{this.applyThemeClass(),this.notifyRenderReady(),this.loadingComplete=!0},e.onerror=()=>{this.fallbackToDefaultTheme()}}ensureBaseCSSLoaded(){let e=document.getElementById("base-css");e||(e=document.createElement("link"),e.id="base-css",e.rel="stylesheet",e.href="css/base.css",e.async=!1,document.head.appendChild(e))}removeExistingThemeCSS(){const e=document.getElementById("theme-css");e&&e.remove()}applyThemeClass(){document.body.classList.remove("win10","win11"),document.body.classList.add(this.currentTheme);const e=document.getElementById("navbar");e&&(e.classList.remove("win10-navbar","win11-navbar"),e.classList.add(`${this.currentTheme}-navbar`)),this.replaceThemeClassNames()}replaceThemeClassNames(){const e="win10"===this.currentTheme?"win11":"win10",t=this.currentTheme,i=document.querySelectorAll(`[class*="${e}-"]`);i.forEach(i=>{const n=i.className.split(" ").map(i=>i.startsWith(`${e}-`)?i.replace(`${e}-`,`${t}-`):i);i.className=n.join(" ")})}fallbackToDefaultTheme(){this.currentTheme=ThemeLoader.DEFAULT_THEME,this.loadThemeCSS(),this.applyThemeClass()}notifyRenderReady(){const e=new CustomEvent("theme.render.ready",{detail:{theme:this.currentTheme}});window.dispatchEvent(e)}triggerThemeLoadedEvent(){const e=new CustomEvent("theme.loaded",{detail:{theme:this.currentTheme,timestamp:Date.now()}});window.dispatchEvent(e)}getCurrentTheme(){return this.currentTheme}switchTheme(e){if(["win10","win11"].includes(e)&&e!==this.currentTheme){this.currentTheme=e,this.loadThemeCSS(),this.applyThemeClass();const t=new CustomEvent("theme.switched",{detail:{theme:e}});window.dispatchEvent(t)}}}const themeLoader=new ThemeLoader;function initThemeLoader(){if(window.siteConfigLoaded)window.siteConfigLoaded.then(()=>{const e=window.siteConfig?.getUIStyle?.()||ThemeLoader.DEFAULT_THEME;document.body.classList.add(e),themeLoader.initialize()}).catch(e=>{document.body.classList.add(ThemeLoader.DEFAULT_THEME),themeLoader.initialize()});else{const e=window.siteConfig?.getUIStyle?.()||ThemeLoader.DEFAULT_THEME;document.body.classList.add(e),themeLoader.initialize()}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",initThemeLoader):initThemeLoader(),window.themeLoader=themeLoader;