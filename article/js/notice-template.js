async function loadMarkdownFile(e){try{const t=await fetch(e);if(!t.ok)throw new Error(`文件加载失败: ${t.status} ${t.statusText}`);const a=await t.text(),{metadata:r,content:s}=parseFrontMatter(a);updatePageMetadata(r),renderMarkdownContent(s)}catch(e){showErrorMessage(e.message)}}function parseFrontMatter(e){if(!e.startsWith("---"))return parseSimpleMarkdownFormat(e);const t=e.split("---");if(t.length<3)return{metadata:{},content:e};const a=t[1],r=t.slice(2).join("---").trim(),s={},l=a.split("\n");for(const e of l){const t=e.indexOf(":");if(t>0){const a=e.substring(0,t).trim();let r=e.substring(t+1).trim();(r.startsWith('"')&&r.endsWith('"')||r.startsWith("'")&&r.endsWith("'"))&&(r=r.slice(1,-1)),s[a]=r}}return{metadata:s,content:r}}function parseSimpleMarkdownFormat(e){const t={},a=e.split("\n");let r=0;for(let e=0;e<a.length;e++){const s=a[e];if(0===e&&s.startsWith("# "))t.title=s.slice(2).trim(),r=e+1;else if(s.includes("发布日期："))t.date=s.replace("> 发布日期：","").trim();else if(s.includes("发布人："))t.author=s.replace("> 发布人：","").trim();else if("---"===s.trim()){r=e+1;break}}return{metadata:t,content:a.slice(r).join("\n").trim()}}function updatePageMetadata(e){if(e.title){document.title=`${e.title} - 九（2）班 班级网站`;const t=document.getElementById("article-title");t&&(t.textContent=e.title)}if(e.level){const t=getLevelMetadata(e.level),a=document.getElementById("notice-level");a&&(a.innerHTML=`\n                <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium text-white" style="${t.style}">\n                    <i class="fas ${t.icon} mr-1"></i>\n                    ${t.name}\n                </span>\n            `)}if(e.date){const t=document.getElementById("notice-date");t&&(t.textContent=formatDate(e.date))}if(e.author){const t=document.getElementById("notice-author");t&&(t.textContent=e.author)}}function renderMarkdownContent(e){const t=document.getElementById("article-content");if(t){try{let a=marked.parse(e);a=a.replace(/<p>/g,'<p class="mb-6 text-gray-700 leading-relaxed">').replace(/<\/p>/g,"</p>"),a=a.replace(/<strong>/g,'<strong class="font-bold text-dark">').replace(/<em>/g,'<em class="italic text-primary">'),a=a.replace(/<a([^>]+)>/g,'<a$1 class="text-primary hover:text-accent underline transition-colors duration-200">'),a=a.replace(/<ul>/g,'<ul class="space-y-2 mb-6 pl-5">').replace(/<li>/g,'<li class="flex items-start">').replace(/<\/li>/g,"</li>"),a=a.replace(/<ol>/g,'<ol class="space-y-2 mb-6 pl-5 list-decimal">').replace(/<li>/g,'<li class="flex items-start">'),a=a.replace(/<blockquote>/g,'<blockquote class="border-l-4 border-primary pl-4 py-2 my-6 bg-light italic text-gray-700">').replace(/<\/blockquote>/g,"</blockquote>"),a=a.replace(/<h1>/g,'<h1 class="text-3xl font-bold text-dark mb-4 pb-2 border-b-2 border-primary">').replace(/<h2>/g,'<h2 class="text-2xl font-bold text-dark mb-3 mt-8">').replace(/<h3>/g,'<h3 class="text-xl font-semibold text-dark mb-2 mt-6">').replace(/<h4>/g,'<h4 class="text-lg font-semibold text-dark mb-2 mt-4">').replace(/<h5>/g,'<h5 class="text-base font-semibold text-dark mb-2 mt-4">').replace(/<h6>/g,'<h6 class="text-sm font-semibold text-dark mb-2 mt-4">'),a=a.replace(/<code>/g,'<code class="bg-gray-100 text-red-600 px-2 py-1 rounded text-sm font-mono">').replace(/<\/code>/g,"</code>"),a=a.replace(/<pre><code/g,'<pre class="bg-gray-900 text-gray-100 p-4 rounded-lg overflow-x-auto my-4"><code').replace(/<\/code><\/pre>/g,"</code></pre>"),a=a.replace(/<table[^>]*>/gi,'<div class="overflow-x-auto py-2"><div class="min-w-[600px] space-y-2">'),a=a.replace(/<\/table>/gi,"</div></div>"),a=a.replace(/<thead[^>]*>(.*?)<\/thead>/gis,(e,t)=>{const a=[...t.matchAll(/<th[^>]*>(.*?)<\/th>/gi)].map(e=>e[1]);return`\n                <div class="hidden md:grid md:grid-cols-${a.length} gap-4 px-4 py-2 text-xs font-semibold text-gray-500 uppercase tracking-wider bg-gray-50 rounded-t-lg">\n                    ${a.map(e=>`<div class="font-medium">${e}</div>`).join("")}\n                </div>`}),a=a.replace(/<tbody[^>]*>(.*?)<\/tbody>/gis,(e,t)=>{const r=[...t.matchAll(/<tr[^>]*>(.*?)<\/tr>/gis)],s=[...a.matchAll(/<th[^>]*>(.*?)<\/th>/gi)].map(e=>e[1]);return r.map(e=>{const t=[...e[1].matchAll(/<td[^>]*>(.*?)<\/td>/gi)].map(e=>e[1]);return`\n                    <div class="grid grid-cols-1 md:grid-cols-${t.length} gap-4 px-4 py-3 bg-white rounded-xl shadow-sm border border-gray-100 text-sm text-gray-900 hover:shadow-md transition-shadow">\n                        ${t.map((e,t)=>`\n                            <div class="flex md:block">\n                                <span class="md:hidden w-24 font-medium text-gray-500">${s[t]||""}：</span>\n                                <span>${e}</span>\n                            </div>`).join("")}\n                    </div>`}).join("")}),a=a.replace(/<\/?(tr|td|th|tbody|thead)[^>]*>/gi,""),a=a.replace(/<hr>/g,'<hr class="my-8 border-0 border-t-2 border-gray-200">'),a=a.replace(/<img([^>]+)>/g,'<img$1 class="max-w-full h-auto rounded-lg shadow-md my-4">'),a=a.replace(/<input type="checkbox"[^>]*>/g,'<input type="checkbox" class="mr-2 h-4 w-4 text-primary rounded focus:ring-primary">'),a=a.replace(/<dt>/g,'<dt class="font-semibold text-dark mt-4">').replace(/<dd>/g,'<dd class="ml-4 mb-2 text-gray-600">'),a=a.replace(/<sup>/g,'<sup class="text-xs text-gray-500">').replace(/<sub>/g,'<sub class="text-xs text-gray-500">'),a=a.replace(/<kbd>/g,'<kbd class="px-2 py-1 text-xs font-semibold text-gray-800 bg-gray-100 border border-gray-200 rounded">'),a=a.replace(/<mark>/g,'<mark class="px-1 py-0.5 bg-yellow-200 text-gray-800 rounded">'),a=a.replace(/<abbr([^>]+)>/g,'<abbr$1 class="border-b border-dotted border-gray-500 cursor-help">'),a=a.replace(/<cite>/g,'<cite class="italic text-gray-600">'),a=a.replace(/<time([^>]+)>/g,'<time$1 class="text-sm text-gray-500">'),a=a.replace(/<!--top-->/gi,'<i class="fas fa-crown text-yellow-500 ml-2" title="第一名"></i>'),t.innerHTML=`\n                <div class="text-gray-700 leading-relaxed">\n                    ${a}\n                </div>\n            `}catch(e){t.innerHTML=`\n            <div class="text-center py-12">\n                <i class="fas fa-exclamation-triangle text-4xl text-red-500 mb-4"></i>\n                <p class="text-lg text-gray-700">渲染文章内容失败</p>\n                <p class="text-sm text-gray-500 mt-2">${e.message}</p>\n            </div>\n        `}"undefined"!=typeof AOS&&AOS.refresh()}}function showErrorMessage(e){const t=document.getElementById("article-content");t&&(t.innerHTML=`\n        <div class="text-center py-12">\n            <i class="fas fa-exclamation-triangle text-4xl text-red-500 mb-4"></i>\n            <p class="text-lg text-gray-700">加载文章失败</p>\n            <p class="text-sm text-gray-500 mt-2">${e}</p>\n            <div class="mt-6">\n                <a href="../Sidebar/notice.html" class="inline-flex items-center px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary/90 transition-colors duration-200">\n                    <i class="fas fa-arrow-left mr-2"></i>\n                    返回通知列表\n                </a>\n            </div>\n        </div>\n    `)}function getLevelMetadata(e){if("win10"===(getComputedStyle(document.documentElement).getPropertyValue("--theme")||"win11")){const t={1:{name:"普通",className:"notice-level-badge notice-level-primary",icon:"fa-file-text"},2:{name:"报告",className:"notice-level-badge notice-level-success",icon:"fa-chart-bar"},3:{name:"活动/表彰",className:"notice-level-badge notice-level-purple",icon:"fa-trophy"}};return t[e]||t[1]}{const t={1:{name:"普通",className:"notice-level-badge notice-level-primary",icon:"fa-file-text"},2:{name:"报告",className:"notice-level-badge notice-level-success",icon:"fa-chart-bar"},3:{name:"活动/表彰",className:"notice-level-badge notice-level-secondary",icon:"fa-trophy"}};return t[e]||t[1]}}function formatDate(e){const t=new Date(e);return`${t.getFullYear()}年${String(t.getMonth()+1).padStart(2,"0")}月${String(t.getDate()).padStart(2,"0")}日`}function initNavbar(){const e=document.getElementById("navbar"),t=document.getElementById("back-to-top"),a=document.getElementById("mobile-menu-button"),r=document.getElementById("mobile-menu");window.addEventListener("scroll",()=>{window.scrollY>50?(e.classList.add("shadow-md"),e.classList.remove("shadow-sm")):(e.classList.remove("shadow-md"),e.classList.add("shadow-sm")),window.scrollY>300?(t.classList.remove("opacity-0","invisible"),t.classList.add("opacity-100","visible")):(t.classList.add("opacity-0","invisible"),t.classList.remove("opacity-100","visible"))}),t&&t.addEventListener("click",()=>{window.scrollTo({top:0,behavior:"smooth"})}),a&&r&&a.addEventListener("click",()=>{r.classList.toggle("hidden")})}document.addEventListener("DOMContentLoaded",function(){initNavbar();const e=new URLSearchParams(window.location.search).get("md");e?loadMarkdownFile(e):showErrorMessage("未指定文章文件")});