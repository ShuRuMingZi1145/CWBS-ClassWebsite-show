let toolModal,toolTitle,toolContent,calcDisplay;function initTreasureBox(){toolModal=document.getElementById("toolModal"),toolTitle=document.getElementById("toolTitle"),toolContent=document.getElementById("toolContent"),initModalClose(),initEchoHole()}function initModalClose(){const e=document.getElementById("closeModal");e&&e.addEventListener("click",closeToolModal),toolModal&&toolModal.addEventListener("click",function(e){e.target===toolModal&&closeToolModal()}),document.addEventListener("keydown",function(e){"Escape"===e.key&&toolModal&&!toolModal.classList.contains("hidden")&&closeToolModal()})}function closeToolModal(){toolModal&&toolModal.classList.add("hidden")}function showToolModal(e,t){if(toolModal&&toolTitle&&toolContent){toolTitle.textContent=e,toolContent.innerHTML=t,toolModal.classList.remove("hidden");const o=document.documentElement.dataset.sidebarTheme||"win11";toolModal.dataset.theme=o}}function openCalculator(){const e=document.documentElement.dataset.sidebarTheme||"win11";if("function"==typeof openEnhancedCalculator)openEnhancedCalculator();else{const t="bg-orange-500 hover:bg-orange-600",o="win10"===e?"bg-gray-200 hover:bg-gray-300":"bg-gray-100 hover:bg-gray-200",n="win10"===e?"bg-gray-100 hover:bg-gray-200":"bg-white hover:bg-gray-50 border border-gray-200",a="win10"===e?"rounded-lg":"rounded-xl";showToolModal("计算器",`\n            <div class="space-y-4">\n                <div class="p-4 ${"win10"===e?"bg-gray-100":"bg-gray-50"} ${a}">\n                    <input type="text" id="calcDisplay" class="w-full p-3 ${"win10"===e?"text-2xl":"text-2xl font-medium"} text-right bg-transparent border-none outline-none" readonly value="0">\n                </div>\n                \n                <div class="grid grid-cols-4 gap-3">\n                    <button onclick="clearCalc()" class="calc-btn p-3 ${"bg-red-500 hover:bg-red-600"} text-white ${a} transition-colors">C</button>\n                    <button onclick="appendToCalc('(')" class="calc-btn p-3 ${o} ${a} transition-colors">(</button>\n                    <button onclick="appendToCalc(')')" class="calc-btn p-3 ${o} ${a} transition-colors">)</button>\n                    <button onclick="appendToCalc('/')" class="calc-btn p-3 ${t} text-white ${a} transition-colors">/</button>\n                    \n                    <button onclick="appendToCalc('7')" class="calc-btn p-3 ${n} ${a} transition-colors">7</button>\n                    <button onclick="appendToCalc('8')" class="calc-btn p-3 ${n} ${a} transition-colors">8</button>\n                    <button onclick="appendToCalc('9')" class="calc-btn p-3 ${n} ${a} transition-colors">9</button>\n                    <button onclick="appendToCalc('*')" class="calc-btn p-3 ${t} text-white ${a} transition-colors">×</button>\n                    \n                    <button onclick="appendToCalc('4')" class="calc-btn p-3 ${n} ${a} transition-colors">4</button>\n                    <button onclick="appendToCalc('5')" class="calc-btn p-3 ${n} ${a} transition-colors">5</button>\n                    <button onclick="appendToCalc('6')" class="calc-btn p-3 ${n} ${a} transition-colors">6</button>\n                    <button onclick="appendToCalc('-')" class="calc-btn p-3 ${t} text-white ${a} transition-colors">-</button>\n                    \n                    <button onclick="appendToCalc('1')" class="calc-btn p-3 ${n} ${a} transition-colors">1</button>\n                    <button onclick="appendToCalc('2')" class="calc-btn p-3 ${n} ${a} transition-colors">2</button>\n                    <button onclick="appendToCalc('3')" class="calc-btn p-3 ${n} ${a} transition-colors">3</button>\n                    <button onclick="appendToCalc('+')" class="calc-btn p-3 ${t} text-white ${a} transition-colors">+</button>\n                    \n                    <button onclick="appendToCalc('0')" class="calc-btn p-3 ${n} ${a} transition-colors col-span-2">0</button>\n                    <button onclick="appendToCalc('.')" class="calc-btn p-3 ${n} ${a} transition-colors">.</button>\n                    <button onclick="calculate()" class="calc-btn p-3 ${"bg-green-500 hover:bg-green-600"} text-white ${a} transition-colors">=</button>\n                </div>\n            </div>\n        `),calcDisplay=document.getElementById("calcDisplay"),calcValue="0"}}let calcValue="0",timerInterval;function appendToCalc(e){"0"===calcValue&&"."!==e?calcValue=e:calcValue+=e,calcDisplay.value=calcValue}function clearCalc(){calcValue="0",calcDisplay.value=calcValue}function calculate(){try{let expression=calcValue.replace(/×/g,"*");const result=eval(expression);calcValue=result.toString(),calcDisplay.value=calcValue}catch(e){calcValue="错误",calcDisplay.value=calcValue}}function openConverter(){const e=document.documentElement.dataset.sidebarTheme||"win11";if("function"==typeof openEnhancedUnitConverter)openEnhancedUnitConverter();else{const t=`${e}-select`,o="text-sm font-medium text-gray-700";showToolModal("单位转换器",`\n            <div class="space-y-4">\n                <div class="grid grid-cols-2 gap-4">\n                    <div>\n                        <label class="block ${o} mb-2">转换类型</label>\n                        <select id="converterType" class="${t}">\n                            <option value="length">长度</option>\n                            <option value="weight">重量</option>\n                            <option value="temperature">温度</option>\n                            <option value="area">面积</option>\n                        </select>\n                    </div>\n                    \n                    <div>\n                        <label class="block ${o} mb-2">从单位</label>\n                        <select id="fromUnit" class="${t}">\n                            <option value="meter">米</option>\n                            <option value="centimeter">厘米</option>\n                            <option value="kilometer">千米</option>\n                            <option value="inch">英寸</option>\n                        </select>\n                    </div>\n                </div>\n                \n                <div class="grid grid-cols-2 gap-4">\n                    <div>\n                        <label class="block ${o} mb-2">输入值</label>\n                        <input type="number" id="inputValue" class="${`${e}-input`}" value="1">\n                    </div>\n                    \n                    <div>\n                        <label class="block ${o} mb-2">到单位</label>\n                        <select id="toUnit" class="${t}">\n                            <option value="centimeter">厘米</option>\n                            <option value="meter">米</option>\n                            <option value="kilometer">千米</option>\n                            <option value="inch">英寸</option>\n                        </select>\n                    </div>\n                </div>\n                \n                <button onclick="convertUnits()" class="${`${e}-button`} primary">转换</button>\n                \n                <div id="converterResult" class="p-4 ${"win10"===e?"bg-gray-50 rounded-lg":"bg-gray-50 rounded-xl"} min-h-[60px] flex items-center justify-center">\n                    <span class="text-gray-400">点击转换查看结果</span>\n                </div>\n            </div>\n        `),setTimeout(()=>{const e=document.getElementById("converterType");e&&e.addEventListener("change",updateConverterUnits)},100)}}function updateConverterUnits(){const e=document.getElementById("converterType").value,t=document.getElementById("fromUnit"),o=document.getElementById("toUnit");let n=[];switch(e){case"length":n=["meter","centimeter","kilometer","inch"];break;case"weight":n=["kilogram","gram","pound","ounce"];break;case"temperature":n=["celsius","fahrenheit","kelvin"];break;case"area":n=["square_meter","square_centimeter","square_kilometer","hectare"]}t.innerHTML="",o.innerHTML="",n.forEach(e=>{const n=document.createElement("option");n.value=e,n.textContent=getUnitName(e),t.appendChild(n);const a=document.createElement("option");a.value=e,a.textContent=getUnitName(e),o.appendChild(a)})}function getUnitName(e){return{meter:"米",centimeter:"厘米",kilometer:"千米",inch:"英寸",kilogram:"千克",gram:"克",pound:"磅",ounce:"盎司",celsius:"摄氏度",fahrenheit:"华氏度",kelvin:"开尔文",square_meter:"平方米",square_centimeter:"平方厘米",square_kilometer:"平方千米",hectare:"公顷"}[e]||e}function convertUnits(){const e=document.getElementById("converterType").value,t=document.getElementById("fromUnit").value,o=document.getElementById("toUnit").value,n=parseFloat(document.getElementById("inputValue").value);if(isNaN(n))return void(document.getElementById("converterResult").innerHTML='<span class="text-danger">请输入有效数值</span>');let a;switch(e){case"length":a=convertLength(n,t,o);break;case"weight":a=convertWeight(n,t,o);break;case"temperature":a=convertTemperature(n,t,o);break;case"area":a=convertArea(n,t,o)}document.getElementById("converterResult").innerHTML=`\n        <div class="text-center">\n            <div class="text-2xl font-bold text-primary">${a}</div>\n            <div class="text-sm text-gray-500 mt-2">${getUnitName(o)}</div>\n        </div>\n    `}function convertLength(e,t,o){let n=e;switch(t){case"centimeter":n=e/100;break;case"kilometer":n=1e3*e;break;case"inch":n=.0254*e}switch(o){case"meter":return n;case"centimeter":return 100*n;case"kilometer":return n/1e3;case"inch":return n/.0254}return e}function convertWeight(e,t,o){let n=e;switch(t){case"gram":n=e/1e3;break;case"pound":n=.453592*e;break;case"ounce":n=.0283495*e}switch(o){case"kilogram":return n;case"gram":return 1e3*n;case"pound":return n/.453592;case"ounce":return n/.0283495}return e}function convertTemperature(e,t,o){let n=e;switch(t){case"fahrenheit":n=5*(e-32)/9;break;case"kelvin":n=e-273.15}switch(o){case"celsius":return n;case"fahrenheit":return 9*n/5+32;case"kelvin":return n+273.15}return e}function convertArea(e,t,o){let n=e;switch(t){case"square_centimeter":n=e/1e4;break;case"square_kilometer":n=1e6*e;break;case"hectare":n=1e4*e}switch(o){case"square_meter":return n;case"square_centimeter":return 1e4*n;case"square_kilometer":return n/1e6;case"hectare":return n/1e4}return e}let timerSeconds=0,isTimerRunning=!1,countdownInterval;function openTimer(){const e=document.documentElement.dataset.sidebarTheme||"win11";showToolModal("计时器",`\n        <div class="space-y-6">\n            <div class="text-center">\n                <div id="timerDisplay" class="timer-display ${"win10"===e?"text-4xl":"text-5xl"} font-mono font-bold text-primary mb-4">00:00:00</div>\n                <div class="flex justify-center space-x-4">\n                    <button id="timerStartBtn" onclick="startTimer()" class="px-6 py-2 ${"win10"===e?"bg-green-500 hover:bg-green-600":"bg-green-500 hover:bg-green-600 rounded-lg"} text-white transition-colors">开始</button>\n                    <button id="timerPauseBtn" onclick="pauseTimer()" class="px-6 py-2 ${"win10"===e?"bg-yellow-500 hover:bg-yellow-600":"bg-yellow-500 hover:bg-yellow-600 rounded-lg"} text-white transition-colors" disabled>暂停</button>\n                    <button onclick="resetTimer()" class="px-6 py-2 ${"win10"===e?"bg-red-500 hover:bg-red-600":"bg-red-500 hover:bg-red-600 rounded-lg"} text-white transition-colors">重置</button>\n                </div>\n            </div>\n            \n            <div class="${"win10"===e?"border-t border-gray-200":"border-t border-gray-100"} pt-4">\n                <h3 class="text-lg font-semibold mb-3">倒计时</h3>\n                <div class="grid grid-cols-2 gap-4">\n                    <input type="number" id="countdownInput" class="${`${e}-input`}" placeholder="秒数" min="1">\n                    <button onclick="startCountdown()" class="px-6 py-2 ${"win10"===e?"bg-blue-500 hover:bg-blue-600":"bg-blue-500 hover:bg-blue-600 rounded-lg"} text-white transition-colors">开始倒计时</button>\n                </div>\n                <div id="countdownDisplay" class="${"win10"===e?"text-2xl":"text-3xl"} font-mono font-bold text-secondary mt-4 text-center">00:00</div>\n            </div>\n        </div>\n    `),timerSeconds=0,isTimerRunning=!1,clearInterval(timerInterval),setTimeout(updateTimerDisplay,10)}function startTimer(){isTimerRunning||(isTimerRunning=!0,document.getElementById("timerStartBtn").disabled=!0,document.getElementById("timerPauseBtn").disabled=!1,timerInterval=setInterval(()=>{timerSeconds++,updateTimerDisplay()},1e3))}function pauseTimer(){isTimerRunning&&(isTimerRunning=!1,document.getElementById("timerStartBtn").disabled=!1,document.getElementById("timerPauseBtn").disabled=!0,clearInterval(timerInterval))}function resetTimer(){pauseTimer(),timerSeconds=0,updateTimerDisplay()}function updateTimerDisplay(){const e=Math.floor(timerSeconds/3600),t=Math.floor(timerSeconds%3600/60),o=timerSeconds%60,n=String(e).padStart(2,"0")+":"+String(t).padStart(2,"0")+":"+String(o).padStart(2,"0");document.getElementById("timerDisplay").textContent=n}let countdownSeconds=0;function startCountdown(){const e=document.getElementById("countdownInput");countdownSeconds=parseInt(e.value),isNaN(countdownSeconds)||countdownSeconds<=0?e.value="":(clearInterval(countdownInterval),countdownInterval=setInterval(()=>{countdownSeconds--,updateCountdownDisplay(),countdownSeconds<=0&&(clearInterval(countdownInterval),document.getElementById("countdownDisplay").textContent="时间到！",document.getElementById("countdownDisplay").classList.add("text-danger"))},1e3),updateCountdownDisplay())}function updateCountdownDisplay(){const e=Math.floor(countdownSeconds/60),t=countdownSeconds%60,o=String(e).padStart(2,"0")+":"+String(t).padStart(2,"0");document.getElementById("countdownDisplay").textContent=o,document.getElementById("countdownDisplay").classList.remove("text-danger")}let randomNumbers=[],echoInput,echoDisplay;function openRandomGenerator(){const e=document.documentElement.dataset.sidebarTheme||"win11";showToolModal("随机数生成器",`\n        <div class="${e}-random-generator-container">\n            \x3c!-- 控制面板 --\x3e\n            <div class="${e}-random-control-card">\n                <div class="${e}-random-card-title">\n                    <i class="fas fa-sliders-h ${e}-random-card-icon"></i>\n                    <h3>随机设置</h3>\n                </div>\n                \n                <div class="${e}-random-input-group">\n                    <div class="${e}-random-input-item">\n                        <label class="${e}-random-label">最小值</label>\n                        <input type="number" id="minValue" class="${e}-random-input" value="1">\n                    </div>\n                    \n                    <div class="${e}-random-input-item">\n                        <label class="${e}-random-label">最大值</label>\n                        <input type="number" id="maxValue" class="${e}-random-input" value="100">\n                    </div>\n                </div>\n                \n                <div class="${e}-random-input-group">\n                    <div class="${e}-random-input-item">\n                        <label class="${e}-random-label">生成数量</label>\n                        <input type="number" id="countValue" class="${e}-random-input" value="1" min="1" max="10">\n                    </div>\n                    \n                    <div class="${e}-random-input-item">\n                        <label class="${e}-random-label">随机模式</label>\n                        <select id="randomMode" class="${e}-random-select">\n                            <option value="integer">整数</option>\n                            <option value="decimal">小数(2位)</option>\n                        </select>\n                    </div>\n                </div>\n                \n                \x3c!-- 快捷预设 --\x3e\n                <div class="${e}-random-presets">\n                    <h4 class="${e}-random-presets-title">快捷预设</h4>\n                    <div class="${e}-random-presets-grid">\n                        <button class="${e}-random-preset-btn secondary" onclick="setRandomPreset(1, 10)">1-10</button>\n                        <button class="${e}-random-preset-btn secondary" onclick="setRandomPreset(1, 100)">1-100</button>\n                        <button class="${e}-random-preset-btn secondary" onclick="setRandomPreset(1, 1000)">1-1000</button>\n                        <button class="${e}-random-preset-btn secondary" onclick="setRandomPreset(1, 6)">骰子(1-6)</button>\n                        <button class="${e}-random-preset-btn secondary" onclick="setRandomPreset(1, 54)">扑克牌(1-54)</button>\n                        <button class="${e}-random-preset-btn secondary" onclick="setRandomPreset(0, 100)">百分比(0-100)</button>\n                    </div>\n                </div>\n                \n                <button onclick="generateRandom()" class="${e}-random-generate-btn primary">\n                    <i class="fas fa-random mr-2"></i>\n                    生成随机数\n                </button>\n            </div>\n            \n            \x3c!-- 结果展示 --\x3e\n            <div class="${e}-random-result-card">\n                <div class="${e}-random-card-title">\n                    <i class="fas fa-magic ${e}-random-card-icon"></i>\n                    <h3>随机结果</h3>\n                </div>\n                \n                <div id="randomResult" class="${e}-random-result-display min-h-[120px] flex items-center justify-center">\n                    <span class="${e}-random-result-placeholder">点击生成随机数</span>\n                </div>\n                \n                \x3c!-- 统计信息 --\x3e\n                <div id="randomStats" class="${e}-random-stats" style="display: none;">\n                    <div class="${e}-random-stat-item">\n                        <span>范围:</span>\n                        <span id="randomRange" class="${e}-random-stat-value"></span>\n                    </div>\n                    <div class="${e}-random-stat-item">\n                        <span>平均值:</span>\n                        <span id="randomAverage" class="${e}-random-stat-value"></span>\n                    </div>\n                    <div class="${e}-random-stat-item">\n                        <span>最大值:</span>\n                        <span id="randomMax" class="${e}-random-stat-value"></span>\n                    </div>\n                    <div class="${e}-random-stat-item">\n                        <span>最小值:</span>\n                        <span id="randomMin" class="${e}-random-stat-value"></span>\n                    </div>\n                </div>\n            </div>\n        </div>\n    `)}function setRandomPreset(e,t){document.getElementById("minValue").value=e,document.getElementById("maxValue").value=t}function generateRandom(){const e=parseFloat(document.getElementById("minValue").value),t=parseFloat(document.getElementById("maxValue").value),o=parseInt(document.getElementById("countValue").value),n=document.getElementById("randomMode").value,a=document.documentElement.dataset.sidebarTheme||"win11";if(isNaN(e)||isNaN(t)||isNaN(o)||e>=t||o<1||o>10)return void(document.getElementById("randomResult").innerHTML=`<span class="${a}-random-error">请输入有效的参数</span>`);const s=[];for(let a=0;a<o;a++)"integer"===n?s.push(Math.floor(Math.random()*(t-e+1))+e):s.push((Math.random()*(t-e)+e).toFixed(2));const r=document.getElementById("randomResult"),d=document.getElementById("randomStats");d.style.display="flex";const l=s.map(e=>parseFloat(e)),i=l.reduce((e,t)=>e+t,0)/l.length,c=Math.max(...l),u=Math.min(...l);document.getElementById("randomRange").textContent=`${e}-${t}`,document.getElementById("randomAverage").textContent=i.toFixed(2),document.getElementById("randomMax").textContent=c,document.getElementById("randomMin").textContent=u,r.innerHTML=`\n        <div class="${a}-random-result-content text-center">\n            <div class="${a}-random-result-numbers">\n                ${s.map(e=>`<span class="${a}-random-result-number">?</span>`).join(" ")}\n            </div>\n        </div>\n    `;const m=r.querySelectorAll(`.${a}-random-result-number`);r.style.position="relative";const p=document.createElement("div");p.style.position="absolute",p.style.top="50%",p.style.left="50%",p.style.width="0",p.style.height="0",p.style.borderRadius="50%",p.style.background="rgba(0, 120, 212, 0.3)",p.style.transform="translate(-50%, -50%)",p.style.transition="all 1s ease-out",p.style.zIndex="0",r.appendChild(p),setTimeout(()=>{p.style.width="300px",p.style.height="300px",p.style.opacity="0"},100),m.forEach((e,t)=>{e.style.opacity="0",e.style.transform="scale(0) rotate(-180deg)",e.style.transition="all 0.8s cubic-bezier(0.68, -0.55, 0.27, 1.55)",e.style.zIndex=100-t,e.style.position="relative",setTimeout(()=>{e.style.opacity="1",e.style.transform="scale(1.4) rotate(360deg)";try{const e=new Audio;e.volume=.3,e.play().catch(()=>{})}catch(e){}setTimeout(()=>{e.style.transform="scale(1) rotate(360deg)";const o=parseFloat(s[t]);let a=0;const r=Math.round(62.5);let d=0;e.style.filter="brightness(1.5) contrast(1.2)",setTimeout(()=>{e.style.filter="brightness(1) contrast(1)"},200);const l=()=>{d++;const i=d/r,c=1-Math.pow(1-i,5);a="integer"===n?Math.floor(c*o):(c*o).toFixed(2);const u=4*(Math.random()-.5),m=4*(Math.random()-.5);if(e.style.transform=`translate(${u}px, ${m}px) scale(1)`,e.textContent=a,d%2==0&&(e.style.transform=`translate(${u}px, ${m}px) scale(1.1)`),d<r)requestAnimationFrame(l);else{e.textContent=s[t],e.style.transform="scale(1.3)",e.style.whiteSpace="nowrap",e.style.display="inline-block",e.style.wordBreak="keep-all",e.style.fontSize="2rem";let o=0;const n=setInterval(()=>{if(o<5){const t=o%2==0?5:-5;e.style.transform=`translateX(${t}px) scale(1.3)`,o++}else clearInterval(n),e.style.transform="scale(1)",e.style.transition="all 0.3s ease"},50)}};requestAnimationFrame(l)},350)},400*t)});const g=document.querySelector(`.${a}-random-result-card`);if(g){g.style.transition="all 0.8s cubic-bezier(0.34, 1.56, 0.64, 1)",g.style.boxShadow="0 15px 30px rgba(0, 120, 212, 0.3)";let e=0;const t=setInterval(()=>{if(e<6){const t=e%2==0?1.03:1;g.style.transform=`scale(${t})`,e++}else clearInterval(t),g.style.transform="scale(1)",g.style.boxShadow="0 8px 16px rgba(0, 0, 0, 0.15)"},300)}d.style.opacity="0",d.style.transform="translateY(20px)",d.style.transition="all 0.5s ease",setTimeout(()=>{d.style.opacity="1",d.style.transform="translateY(0)"},300*s.length+500)}function openCountdown(){const e=document.documentElement.dataset.sidebarTheme||"win11";if("function"==typeof openEnhancedCountdown)openEnhancedCountdown();else{const t=`${e}-input`,o="text-sm font-medium text-gray-700";showToolModal("倒日历",`\n            <div class="space-y-4">\n                <div>\n                    <label class="block ${o} mb-2">选择目标日期</label>\n                    <input type="date" id="targetDate" class="${t}">\n                </div>\n                \n                <div>\n                    <label class="block ${o} mb-2">事件名称</label>\n                    <input type="text" id="eventName" class="${t}" placeholder="例如: 高考">\n                </div>\n                \n                <button onclick="calculateCountdown()" class="${`${e}-button`} primary">计算剩余时间</button>\n                \n                <div id="countdownResult" class="p-6 ${"win10"===e?"bg-gray-50 rounded-lg":"bg-gradient-to-br from-gray-50 to-green-50 rounded-xl shadow-sm"} min-h-[120px] text-center flex flex-col items-center justify-center transition-all duration-300">\n                    <span class="text-gray-400">选择日期并计算</span>\n                </div>\n            </div>\n        `)}}function calculateCountdown(){const e=new Date(document.getElementById("targetDate").value),t=document.getElementById("eventName").value||"目标日期",o=new Date,n=document.documentElement.dataset.sidebarTheme||"win11";if(isNaN(e.getTime()))return void(document.getElementById("countdownResult").innerHTML='<span class="text-danger">请选择有效日期</span>');const a=document.getElementById("countdownResult");a.classList.add("scale-105"),setTimeout(()=>{a.classList.remove("scale-105")},300);const s=e-o,r=Math.ceil(s/864e5);let d;const l="win10"===n?"text-xl":"text-2xl";if(r<0)d=`<div class="text-center">\n            <div class="${l} font-bold text-danger">${t} 已过去${Math.abs(r)} 天</div>\n        </div>`;else if(0===r)d=`<div class="text-center">\n            <div class="${l} font-bold text-primary">今天就是 ${t}</div>\n        </div>`;else{const e=Math.floor(r/365),o=Math.floor(r%365/30);let n="";e>0&&(n+=`${e}年`),o>0&&(n+=`${o}个月 `),n+=`${r%30}天`,d=`<div class="text-center">\n            <div class="${l} font-bold text-primary">距离 ${t} 还有</div>\n            <div class="${l} font-bold text-primary mt-2">${n}</div>\n            <div class="text-sm text-gray-500 mt-2">总计 ${r} 天</div>\n        </div>`}a.innerHTML=d}function openBMI(){showToolModal("BMI计算器",'\n        <div class="space-y-4">\n            <div>\n                <label class="block text-sm font-medium text-gray-700 mb-2">身高 (厘米)</label>\n                <input type="number" id="height" class="w-full p-2 border border-gray-300 rounded-lg" placeholder="例如: 170">\n            </div>\n            \n            <div>\n                <label class="block text-sm font-medium text-gray-700 mb-2">体重 (千克)</label>\n                <input type="number" id="weight" class="w-full p-2 border border-gray-300 rounded-lg" placeholder="例如: 65">\n            </div>\n            \n            <button onclick="calculateBMI()" class="w-full p-2 bg-primary text-white rounded-lg hover:bg-primary/90 transition-colors primary">计算BMI</button>\n            \n            <div id="bmiResult" class="p-4 bg-gray-50 rounded-lg min-h-[100px] flex items-center justify-center">\n                <span class="text-gray-400">输入身高体重并计算</span>\n            </div>\n            \n            <div class="text-sm text-gray-600">\n                <p class="font-medium mb-2">BMI参考标准：</p>\n                <div class="space-y-1">\n                    <div class="flex justify-between">\n                        <span>偏瘦：</span>\n                        <span>&lt; 18.5</span>\n                    </div>\n                    <div class="flex justify-between">\n                        <span>正常：</span>\n                        <span>18.5 - 23.9</span>\n                    </div>\n                    <div class="flex justify-between">\n                        <span>超重：</span>\n                        <span>24 - 27.9</span>\n                    </div>\n                    <div class="flex justify-between">\n                        <span>肥胖：</span>\n                        <span>≥ 28</span>\n                    </div>\n                </div>\n            </div>\n        </div>\n    ')}function calculateBMI(){const e=parseFloat(document.getElementById("height").value),t=parseFloat(document.getElementById("weight").value);if(isNaN(e)||isNaN(t)||e<=0||t<=0)return void(document.getElementById("bmiResult").innerHTML='<span class="text-danger">请输入有效的身高和体重</span>');const o=e/100,n=t/(o*o);let a,s;n<18.5?(a="偏瘦",s="text-blue-600"):n<24?(a="正常",s="text-green-600"):n<28?(a="超重",s="text-warning"):(a="肥胖",s="text-danger"),document.getElementById("bmiResult").innerHTML=`\n        <div class="text-center">\n            <div class="text-2xl font-bold ${s}">${n.toFixed(1)}</div>\n            <div class="text-lg ${s}">${a}</div>\n        </div>\n    `}let echoMessages=[];function initEchoHole(){echoInput=document.getElementById("echoInput"),echoDisplay=document.getElementById("echoDisplay"),echoInput&&echoDisplay&&(echoInput.addEventListener("keypress",e=>{"Enter"===e.key&&sendEcho()}),displayEchoMessages())}function sendEcho(){const e=echoInput.value.trim();e&&(echoMessages.push({text:e,timestamp:(new Date).toLocaleTimeString()}),echoInput.value="",displayEchoMessages())}function displayEchoMessages(){if(!echoDisplay)return;if(0===echoMessages.length)return echoDisplay.innerHTML='<div class="echo-placeholder">你的回声将在这里显示...</div>',void echoDisplay.addEventListener("click",function(e){(e.target===echoDisplay||e.target.classList.contains("echo-placeholder"))&&showRandomEcho()});let e="";echoMessages.forEach((t,o)=>{e+=`\n            <div class="echo-message mb-3 p-3 bg-white rounded-lg shadow-sm">\n                <div class="flex justify-between items-start mb-1">\n                    <span class="text-xs text-gray-500">${t.timestamp}</span>\n                    <button onclick="deleteEcho(${o})" class="text-gray-400 hover:text-danger">\n                        <i class="fas fa-times"></i>\n                    </button>\n                </div>\n                <div class="typing-text" data-text="${t.text}"></div>\n            </div>\n        `}),echoDisplay.innerHTML=e,setTimeout(()=>{document.querySelectorAll(".typing-text").forEach(e=>{startTypingEffect(e)})},100)}const randomEchoes=["青春是一场回不去的旅行，珍惜当下，不负韶华。","每一次努力都是未来的铺垫，坚持就是胜利。","班级是我们共同的家，让我们一起守护这份温暖。","知识改变命运，学习成就未来。","今天的努力，是明天的实力。","梦想不会逃跑，逃跑的永远是自己。","成功的路上并不拥挤，因为坚持的人不多。","每一次跌倒，都是为了更好地站起来。","青春不散场，我们不分离。","用汗水浇灌梦想，用时间证明自己。","班级因你我而精彩，青春因奋斗而闪光。","学习是灯，努力是油，要想灯亮，必须加油。","今天的你，是昨天努力的成果；明天的你，是今天奋斗的结果。","青春是用来奋斗的，不是用来挥霍的。","在班级里，我们不仅是同学，更是战友。"];function showRandomEcho(){const e=Math.floor(Math.random()*randomEchoes.length),t=randomEchoes[e];echoDisplay.innerHTML="";const o=document.createElement("div");o.className="echo-message mb-3 p-3 bg-white rounded-lg shadow-sm",o.innerHTML=`\n        <div class="flex justify-between items-start mb-1">\n            <span class="text-xs text-gray-500">回声墙</span>\n        </div>\n        <div class="typing-text" data-text="${t}"></div>\n    `,echoDisplay.appendChild(o),setTimeout(()=>{startTypingEffect(o.querySelector(".typing-text"))},100)}function startTypingEffect(e){const t=e.getAttribute("data-text");let o=0;e.innerHTML="";const n=setInterval(()=>{o<t.length?(e.innerHTML+=t.charAt(o),o++):(clearInterval(n),e.classList.add("typing-cursor"),setTimeout(()=>{e.classList.remove("typing-cursor")},1e3))},50)}function deleteEcho(e){echoMessages.splice(e,1),displayEchoMessages()}let pomodoroTimer,pomodoroSeconds=1500,pomodoroIsWorking=!0,pomodoroWorkTime=1500,pomodoroBreakTime=300,pomodoroLongBreakTime=900,pomodoroSessionCount=0,pomodoroTodayCount=parseInt(localStorage.getItem("pomodoroTodayCount")||"0"),pomodoroTotalWorkTime=parseInt(localStorage.getItem("pomodoroTotalWorkTime")||"0"),pomodoroLastResetDate=localStorage.getItem("pomodoroLastResetDate")||(new Date).toDateString();function openPomodoro(){pomodoroLastResetDate!==(new Date).toDateString()&&(pomodoroTodayCount=0,localStorage.setItem("pomodoroTodayCount","0"),localStorage.setItem("pomodoroLastResetDate",(new Date).toDateString()));showToolModal("番茄钟",`\n        <div class="pomodoro-timer-container">\n            <div class="pomodoro-status working" id="pomodoroStatus">工作时间</div>\n            <div class="pomodoro-progress-ring">\n                <svg width="200" height="200">\n                    <circle class="pomodoro-progress-ring-circle pomodoro-progress-ring-bg" \n                            cx="100" cy="100" r="90"></circle>\n                    <circle class="pomodoro-progress-ring-circle pomodoro-progress-ring-progress" \n                            cx="100" cy="100" r="90"\n                            stroke-dasharray="565.48" stroke-dashoffset="0"></circle>\n                </svg>\n                <div class="pomodoro-progress-text" id="pomodoroProgressText">25:00</div>\n            </div>\n            <div class="pomodoro-dots" id="pomodoroDots">\n                <div class="pomodoro-dot"></div>\n                <div class="pomodoro-dot"></div>\n                <div class="pomodoro-dot"></div>\n                <div class="pomodoro-dot"></div>\n            </div>\n        </div>\n        \n        <div class="pomodoro-controls">\n            <button onclick="startPomodoro()" id="pomodoroStartBtn" class="pomodoro-control-btn start-btn">开始</button>\n             <button onclick="pausePomodoro()" id="pomodoroPauseBtn" class="pomodoro-control-btn pause-btn" disabled>暂停</button>\n             <button onclick="resetPomodoro()" class="pomodoro-control-btn reset-btn">重置</button>\n        </div>\n        \n        <div class="pomodoro-presets">\n            <button class="pomodoro-preset-btn active" data-preset="classic" onclick="applyPomodoroPreset('classic')">经典</button>\n             <button class="pomodoro-preset-btn" data-preset="short" onclick="applyPomodoroPreset('short')">短时</button>\n             <button class="pomodoro-preset-btn" data-preset="long" onclick="applyPomodoroPreset('long')">长时</button>\n             <button class="pomodoro-preset-btn" data-preset="custom" onclick="applyPomodoroPreset('custom')">自定义</button>\n        </div>\n        \n        <div class="pomodoro-settings" id="pomodoroSettings" style="display: none;">\n            <div class="pomodoro-setting-group">\n                <label class="pomodoro-setting-label">工作时间 (分钟)</label>\n                <input type="number" id="workTime" class="pomodoro-setting-input" value="25" min="1" max="60">\n            </div>\n            <div class="pomodoro-setting-group">\n                <label class="pomodoro-setting-label">短休息 (分钟)</label>\n                <input type="number" id="shortBreak" class="pomodoro-setting-input" value="5" min="1" max="30">\n            </div>\n            <div class="pomodoro-setting-group">\n                <label class="pomodoro-setting-label">长休息 (分钟)</label>\n                <input type="number" id="longBreak" class="pomodoro-setting-input" value="15" min="1" max="60">\n            </div>\n            <div class="pomodoro-setting-group">\n                <label class="pomodoro-setting-label">长休息间隔</label>\n                <input type="number" id="longBreakInterval" class="pomodoro-setting-input" value="4" min="2" max="10">\n            </div>\n        </div>\n        \n        <div class="pomodoro-stats">\n            <div>今日完成番茄数: <span id="todayPomodoros">${pomodoroTodayCount}</span></div>\n            <div>总工作时间: <span id="totalWorkTime">${pomodoroTotalWorkTime}分钟</span></div>\n        </div>\n    `),updatePomodoroProgress()}const pomodoroPresets={classic:{work:25,shortBreak:5,longBreak:15,interval:4},short:{work:15,shortBreak:3,longBreak:10,interval:4},long:{work:45,shortBreak:10,longBreak:20,interval:6},custom:{work:25,shortBreak:5,longBreak:15,interval:4}};function applyPomodoroPreset(e){const t=pomodoroPresets[e];t&&(pomodoroWorkTime=60*t.work,pomodoroBreakTime=60*t.shortBreak,pomodoroLongBreakTime=60*t.longBreak,document.getElementById("workTime").value=t.work,document.getElementById("shortBreak").value=t.shortBreak,document.getElementById("longBreak").value=t.longBreak,document.getElementById("longBreakInterval").value=t.interval,document.querySelectorAll(".pomodoro-preset-btn").forEach(e=>{e.classList.remove("active")}),document.querySelector(`[data-preset="${e}"]`).classList.add("active"),document.getElementById("pomodoroSettings").style.display="custom"===e?"grid":"none",pomodoroTimer||resetPomodoro())}function updatePomodoroProgress(){const e=pomodoroIsWorking?pomodoroWorkTime:pomodoroSessionCount%4==0&&pomodoroSessionCount>0?pomodoroLongBreakTime:pomodoroBreakTime,t=(e-pomodoroSeconds)/e,o=2*Math.PI*90,n=o-t*o,a=document.querySelector(".pomodoro-progress-ring-progress");a&&(a.style.strokeDashoffset=n)}function startPomodoro(){pomodoroTimer||(document.getElementById("workTime")&&(pomodoroWorkTime=60*parseInt(document.getElementById("workTime").value),pomodoroBreakTime=60*parseInt(document.getElementById("shortBreak").value),pomodoroLongBreakTime=60*parseInt(document.getElementById("longBreak").value)),(0===pomodoroSeconds||pomodoroIsWorking&&pomodoroSeconds===pomodoroWorkTime||!pomodoroIsWorking&&pomodoroSeconds===pomodoroBreakTime)&&(pomodoroSeconds=pomodoroIsWorking?pomodoroWorkTime:pomodoroBreakTime),document.getElementById("pomodoroStartBtn").disabled=!0,document.getElementById("pomodoroPauseBtn").disabled=!1,updatePomodoroStatus(),pomodoroTimer=setInterval(()=>{pomodoroSeconds--,updatePomodoroDisplay(),updatePomodoroProgress(),pomodoroSeconds<=0&&(clearInterval(pomodoroTimer),pomodoroTimer=null,playNotificationSound(),pomodoroIsWorking?(pomodoroSessionCount++,pomodoroTodayCount++,pomodoroTotalWorkTime+=Math.floor(pomodoroWorkTime/60),localStorage.setItem("pomodoroTodayCount",pomodoroTodayCount.toString()),localStorage.setItem("pomodoroTotalWorkTime",pomodoroTotalWorkTime.toString()),document.getElementById("todayPomodoros").textContent=pomodoroTodayCount,document.getElementById("totalWorkTime").textContent=pomodoroTotalWorkTime+"分钟",updatePomodoroDots(),pomodoroSessionCount%4==0?(pomodoroSeconds=pomodoroLongBreakTime,showNotification("番茄钟","恭喜完成4个番茄钟！享受15分钟长休息吧！")):(pomodoroSeconds=pomodoroBreakTime,showNotification("番茄钟","工作时间结束！休息5分钟吧！"))):(pomodoroSeconds=pomodoroWorkTime,showNotification("番茄钟","休息结束！开始新的番茄钟吧！")),pomodoroIsWorking=!pomodoroIsWorking,updatePomodoroStatus(),updatePomodoroDisplay(),updatePomodoroProgress(),document.getElementById("pomodoroStartBtn").disabled=!1,document.getElementById("pomodoroPauseBtn").disabled=!0)},1e3))}function pausePomodoro(){pomodoroTimer&&(clearInterval(pomodoroTimer),pomodoroTimer=null,document.getElementById("pomodoroStartBtn").disabled=!1,document.getElementById("pomodoroPauseBtn").disabled=!0)}function resetPomodoro(){pausePomodoro(),pomodoroIsWorking=!0,pomodoroSeconds=pomodoroWorkTime,pomodoroSessionCount=0,updatePomodoroDisplay(),updatePomodoroStatus(),updatePomodoroDots(),updatePomodoroProgress(),document.getElementById("pomodoroStartBtn").disabled=!1,document.getElementById("pomodoroPauseBtn").disabled=!0}function updatePomodoroDisplay(){const e=Math.floor(pomodoroSeconds/60),t=pomodoroSeconds%60,o=String(e).padStart(2,"0")+":"+String(t).padStart(2,"0"),n=document.getElementById("pomodoroProgressText")||document.getElementById("pomodoroDisplay");n&&(n.textContent=o)}function updatePomodoroStatus(){const e=document.getElementById("pomodoroStatus");e&&(pomodoroIsWorking?(e.textContent="工作时间",e.className="pomodoro-status working"):pomodoroSessionCount%4==0&&pomodoroSessionCount>0?(e.textContent="长休息时间",e.className="pomodoro-status long-break"):(e.textContent="短休息时间",e.className="pomodoro-status short-break"))}function updatePomodoroDots(){const e=document.getElementById("pomodoroDots");if(e){e.querySelectorAll(".pomodoro-dot").forEach((e,t)=>{t<pomodoroSessionCount%4?e.classList.add("active"):e.classList.remove("active")})}else for(let e=1;e<=4;e++){const t=document.getElementById(`pomodoroDot${e}`);t&&(t.className=e<=pomodoroSessionCount%4?"w-3 h-3 rounded-full bg-primary":"w-3 h-3 rounded-full bg-gray-300")}}let todos=[];function openTodoList(){const e=localStorage.getItem("treasurebox_todos");e&&(todos=JSON.parse(e));showToolModal("待办事项",renderTodoListHtml()),setTimeout(()=>{document.getElementById("newTodoInput")?.addEventListener("keypress",e=>{"Enter"===e.key&&addTodo()})},10)}function renderTodoListHtml(){return`\n        <div class="space-y-4">\n            <div class="flex space-x-2">\n                <input type="text" id="newTodoInput" placeholder="添加新的待办事项..." class="flex-1 p-2 border border-gray-300 rounded-lg">\n                <button onclick="addTodo()" class="p-2 bg-primary text-white rounded-lg hover:bg-primary/90 transition-colors primary">\n                    <i class="fas fa-plus"></i>\n                </button>\n            </div>\n            \n            <div class="flex space-x-2 mb-4">\n                <button onclick="filterTodos('all')" class="px-3 py-1 text-sm rounded-full bg-gray-200 text-gray-700 secondary" id="filterAll">全部</button>\n                <button onclick="filterTodos('active')" class="px-3 py-1 text-sm rounded-full bg-gray-100 text-gray-600 secondary" id="filterActive">未完成</button>\n                <button onclick="filterTodos('completed')" class="px-3 py-1 text-sm rounded-full bg-gray-100 text-gray-600 secondary" id="filterCompleted">已完成</button>\n            </div>\n            \n            <div id="todoList" class="space-y-2 max-h-96 overflow-y-auto">\n                ${renderTodoItems()}\n            </div>\n            \n            <div class="flex justify-between items-center text-sm text-gray-600">\n                <span id="todoCount">0 个待办事项</span>\n                <button onclick="clearCompleted()" class="text-red-600 hover:text-red-800">清除已完成</button>\n            </div>\n        </div>\n    `}function renderTodoList(){const e=`\n        <div class="space-y-4">\n            <div class="flex space-x-2">\n                <input type="text" id="newTodoInput" placeholder="添加新的待办事项..." class="flex-1 p-2 border border-gray-300 rounded-lg">\n                <button onclick="addTodo()" class="p-2 bg-primary text-white rounded-lg hover:bg-primary/90 transition-colors primary">\n                    <i class="fas fa-plus"></i>\n                </button>\n            </div>\n            \n            <div class="flex space-x-2 mb-4">\n                <button onclick="filterTodos('all')" class="px-3 py-1 text-sm rounded-full bg-gray-200 text-gray-700 secondary" id="filterAll">全部</button>\n                <button onclick="filterTodos('active')" class="px-3 py-1 text-sm rounded-full bg-gray-100 text-gray-600 secondary" id="filterActive">未完成</button>\n                <button onclick="filterTodos('completed')" class="px-3 py-1 text-sm rounded-full bg-gray-100 text-gray-600 secondary" id="filterCompleted">已完成</button>\n            </div>\n            \n            <div id="todoList" class="space-y-2 max-h-96 overflow-y-auto">\n                ${renderTodoItems()}\n            </div>\n            \n            <div class="flex justify-between items-center text-sm text-gray-600">\n                <span id="todoCount">0 个待办事项</span>\n                <button onclick="clearCompleted()" class="text-red-600 hover:text-red-800">清除已完成</button>\n            </div>\n        </div>\n    `;toolContent.innerHTML=e,document.getElementById("newTodoInput").addEventListener("keypress",e=>{"Enter"===e.key&&addTodo()}),updateTodoCount()}function renderTodoItems(e="all"){let t=todos;return"active"===e?t=todos.filter(e=>!e.completed):"completed"===e&&(t=todos.filter(e=>e.completed)),0===t.length?'<div class="text-center text-gray-400 py-8">暂无待办事项</div>':t.map((e,t)=>{const o=todos.indexOf(e);return`\n            <div class="flex items-center space-x-2 p-3 bg-gray-50 rounded-lg ${e.completed?"opacity-60":""}">\n                <input type="checkbox" ${e.completed?"checked":""} onchange="toggleTodo(${o})" class="w-4 h-4 text-primary">\n                <span class="flex-1 ${e.completed?"line-through text-gray-500":""}">${e.text}</span>\n                <button onclick="deleteTodo(${o})" class="text-red-500 hover:text-red-700">\n                    <i class="fas fa-trash"></i>\n                </button>\n            </div>\n        `}).join("")}function addTodo(){const e=document.getElementById("newTodoInput"),t=e.value.trim();t&&(todos.unshift({text:t,completed:!1,createdAt:(new Date).toISOString()}),saveTodos(),e.value="",renderTodoItems(),updateTodoCount())}function toggleTodo(e){todos[e].completed=!todos[e].completed,saveTodos(),renderTodoItems(),updateTodoCount()}function deleteTodo(e){todos.splice(e,1),saveTodos(),renderTodoItems(),updateTodoCount()}function filterTodos(e){document.getElementById("filterAll").className="all"===e?"px-3 py-1 text-sm rounded-full bg-primary text-white":"px-3 py-1 text-sm rounded-full bg-gray-100 text-gray-600",document.getElementById("filterActive").className="active"===e?"px-3 py-1 text-sm rounded-full bg-primary text-white":"px-3 py-1 text-sm rounded-full bg-gray-100 text-gray-600",document.getElementById("filterCompleted").className="completed"===e?"px-3 py-1 text-sm rounded-full bg-primary text-white":"px-3 py-1 text-sm rounded-full bg-gray-100 text-gray-600",document.getElementById("todoList").innerHTML=renderTodoItems(e)}function clearCompleted(){todos=todos.filter(e=>!e.completed),saveTodos(),renderTodoItems(),updateTodoCount()}function saveTodos(){localStorage.setItem("treasurebox_todos",JSON.stringify(todos))}function updateTodoCount(){const e=todos.filter(e=>!e.completed).length;document.getElementById("todoCount").textContent=`${e} 个待办事项`}function openGradeCalculator(){showToolModal("成绩计算器",'\n        <div class="grade-calculator-container">\n            <div class="grade-presets">\n                <h3>快速设置</h3>\n                <div class="preset-buttons">\n                    <button class="preset-btn active" data-preset="default">我的设置</button>\n                    <button class="preset-btn" data-preset="custom">自定义</button>\n                </div>\n            </div>\n            \n            <div class="grade-inputs" id="gradeInputs">\n                \x3c!-- 默认科目将在这里动态生成 --\x3e\n            </div>\n            \n            <div class="grade-actions">\n                <button id="addSubjectBtn" class="add-subject-btn">添加科目</button>\n                <button id="calculateBtn" class="calculate-btn">计算成绩</button>\n                <button id="clearBtn" class="reset-btn">清空数据</button>\n            </div>\n            \n            <div class="grade-results" id="gradeResults" style="display: none;">\n                <h3>计算结果</h3>\n                \n                <div class="result-section">\n                    <h4>原始成绩</h4>\n                    <div class="result-item">\n                        <span>总分：</span>\n                        <span id="totalScore" class="result-value">-</span>\n                    </div>\n                    <div class="result-item">\n                        <span>平均分：</span>\n                        <span id="arithmeticAverage" class="result-value">-</span>\n                    </div>\n                    <div class="result-item">\n                        <span>最高分科目：</span>\n                        <span id="highestSubject" class="result-value">-</span>\n                    </div>\n                    <div class="result-item">\n                        <span>最低分科目：</span>\n                        <span id="lowestSubject" class="result-value">-</span>\n                    </div>\n                </div>\n                \n                <div class="result-section">\n                    <h4>折分后成绩</h4>\n                    <div class="result-item">\n                        <span>折分总分：</span>\n                        <span id="weightedTotalScore" class="result-value">-</span>\n                    </div>\n                    <div class="result-item">\n                        <span>折分平均分：</span>\n                        <span id="weightedAverage" class="result-value">-</span>\n                    </div>\n                    <div class="result-item">\n                        <span>等级评定：</span>\n                        <span id="gradeLevel" class="result-value">-</span>\n                    </div>\n                </div>\n                \n                <div class="result-section">\n                    <h4>成绩分析</h4>\n                    <div class="result-item">\n                        <span>优秀科目数：</span>\n                        <span id="excellentCount" class="result-value">-</span>\n                    </div>\n                    <div class="result-item">\n                        <span>及格科目数：</span>\n                        <span id="passCount" class="result-value">-</span>\n                    </div>\n                    <div class="result-item">\n                        <span>不及格科目数：</span>\n                        <span id="failCount" class="result-value">-</span>\n                    </div>\n                </div>\n                \n                <div class="grade-chart">\n                    <h4>成绩分布</h4>\n                    <div id="gradeBars" class="grade-bars">\n                        \x3c!-- 成绩条将在这里动态生成 --\x3e\n                    </div>\n                </div>\n            </div>\n        </div>\n    ');let e={subjects:[{name:"语文",score:0,percentage:100},{name:"数学",score:0,percentage:100},{name:"英语",score:0,percentage:100},{name:"物理",score:0,percentage:90},{name:"化学",score:0,percentage:60},{name:"生物",score:0,percentage:30},{name:"政治",score:0,percentage:50},{name:"历史",score:0,percentage:50},{name:"地理",score:0,percentage:30}],preset:"default"};const t={default:[{name:"语文",percentage:100},{name:"数学",percentage:100},{name:"英语",percentage:100},{name:"物理",percentage:90},{name:"化学",percentage:60},{name:"生物",percentage:30},{name:"政治",percentage:50},{name:"历史",percentage:50},{name:"地理",percentage:30}]},o=document.getElementById("gradeInputs"),n=document.getElementById("gradeResults"),a=document.getElementById("addSubjectBtn"),s=document.getElementById("calculateBtn"),r=document.getElementById("clearBtn"),d=document.querySelectorAll(".preset-btn");function l(){o.innerHTML="",e.subjects.forEach((e,t)=>{const n=document.createElement("div");n.className="grade-input-group",n.innerHTML=`\n                <label>科目 ${t+1}:</label>\n                <input type="text" class="grade-input grade-name" value="${e.name}" placeholder="科目名称" data-index="${t}">\n                <input type="number" class="grade-input grade-score" value="${e.score}" placeholder="分数" min="0" max="100" data-index="${t}">\n                <div class="grade-percentage-container">\n                    <input type="number" class="grade-percentage" value="${e.percentage}" placeholder="比重" min="0" max="100" data-index="${t}">\n                    <span>%</span>\n                </div>\n                <button class="btn-remove" data-index="${t}">删除</button>\n            `,o.appendChild(n)}),document.querySelectorAll(".grade-name").forEach(t=>{t.addEventListener("input",t=>{const o=parseInt(t.target.dataset.index);e.subjects[o].name=t.target.value})}),document.querySelectorAll(".grade-score").forEach(t=>{t.addEventListener("input",t=>{const o=parseInt(t.target.dataset.index);e.subjects[o].score=parseFloat(t.target.value)||0})}),document.querySelectorAll(".grade-percentage").forEach(t=>{t.addEventListener("input",t=>{const o=parseInt(t.target.dataset.index);e.subjects[o].percentage=parseFloat(t.target.value)||0,i()})}),document.querySelectorAll(".btn-remove").forEach(t=>{t.addEventListener("click",t=>{const o=parseInt(t.target.dataset.index);e.subjects.length>1&&(e.subjects.splice(o,1),l())})})}function i(){const t=e.subjects.reduce((e,t)=>e+t.percentage,0);if(Math.abs(t-100)>.01){const e=document.getElementById("percentageWarning");if(e)e.style.display="block",e.textContent=`注意：当前比重总和为${t}%，建议调整为100%`;else{const e=document.createElement("div");e.id="percentageWarning",e.className="percentage-warning",e.textContent=`注意：当前比重总和为${t}%，建议调整为100%`,o.appendChild(e)}}else{const e=document.getElementById("percentageWarning");e&&(e.style.display="none")}return t}a.addEventListener("click",function(){e.subjects.push({name:`科目${e.subjects.length+1}`,score:0,percentage:0}),l()}),s.addEventListener("click",function(){i();let t=0,o=0,a=0,s=100,r="",d="",l=0,c=0,u=0,m=0;e.subjects.forEach(e=>{e.score>0&&(t+=e.score,o++,e.score>a&&(a=e.score,r=e.name),e.score<s&&(s=e.score,d=e.name),l+=e.score*(e.percentage/100),e.score>=90?c++:e.score>=60?u++:m++)});const p=o>0?t/o:0,g=l,v=l;let y="";y=g>=90?"优秀":g>=80?"良好":g>=70?"中等":g>=60?"及格":"不及格",document.getElementById("totalScore").textContent=t.toFixed(2),document.getElementById("arithmeticAverage").textContent=p.toFixed(2),document.getElementById("highestSubject").textContent=r?`${r} (${a}分)`:"-",document.getElementById("lowestSubject").textContent=d?`${d} (${s}分)`:"-",document.getElementById("weightedTotalScore").textContent=v.toFixed(2),document.getElementById("weightedAverage").textContent=g.toFixed(2),document.getElementById("gradeLevel").textContent=y,document.getElementById("excellentCount").textContent=c,document.getElementById("passCount").textContent=u,document.getElementById("failCount").textContent=m;const b=document.getElementById("gradeBars");b.innerHTML="",e.subjects.forEach(e=>{if(e.score>0){const t=document.createElement("div");t.className="grade-bar-container";const o=document.createElement("div");o.className="grade-bar",e.score>=90?o.classList.add("grade-excellent"):e.score>=80?o.classList.add("grade-good"):e.score>=70?o.classList.add("grade-average"):e.score>=60?o.classList.add("grade-pass"):o.classList.add("grade-fail"),o.style.width=`${e.score}%`;const n=document.createElement("div");n.className="grade-bar-label",n.textContent=`${e.name}: ${e.score}分 (比重${e.percentage}%)`,t.appendChild(o),t.appendChild(n),b.appendChild(t)}}),n.style.display="block"}),r.addEventListener("click",function(){e.subjects.forEach(e=>{e.score=0}),l(),n.style.display="none"}),d.forEach(o=>{o.addEventListener("click",()=>{!function(o){if("custom"===o)return;const n=t[o];n&&(e.subjects=n.map(e=>({name:e.name,score:0,percentage:e.percentage})),e.preset=o,l(),d.forEach(e=>{e.classList.remove("active"),e.getAttribute("data-preset")===o&&e.classList.add("active")}))}(o.getAttribute("data-preset"))})}),l()}function renderGradeInputs(e){return e.map((e,t)=>`\n        <div class="flex items-center space-x-2">\n            <input type="text" value="${e.subject}" onchange="updateGradeSubject(${t}, this.value)" class="w-20 p-2 border border-gray-300 rounded-lg text-sm">\n            <input type="number" value="${e.score}" onchange="updateGradeScore(${t}, this.value)" min="0" max="100" class="flex-1 p-2 border border-gray-300 rounded-lg text-sm" placeholder="成绩">\n            <input type="number" value="${e.credit}" onchange="updateGradeCredit(${t}, this.value)" min="0.5" max="10" step="0.5" class="w-16 p-2 border border-gray-300 rounded-lg text-sm" placeholder="学分">\n            <button onclick="removeSubject(${t})" class="p-2 text-red-500 hover:text-red-700">\n                <i class="fas fa-trash"></i>\n            </button>\n        </div>\n    `).join("")}function updateGradeSubject(e,t){const o=getGradesFromInputs();o[e].subject=t,saveGrades(o)}function updateGradeScore(e,t){const o=getGradesFromInputs();o[e].score=parseFloat(t)||0,saveGrades(o)}function updateGradeCredit(e,t){const o=getGradesFromInputs();o[e].credit=parseFloat(t)||1,saveGrades(o)}function getGradesFromInputs(){const e=[];return document.getElementById("gradesList").querySelectorAll("div").forEach(t=>{const o=t.querySelectorAll("input");e.push({subject:o[0].value,score:parseFloat(o[1].value)||0,credit:parseFloat(o[2].value)||1})}),e}function saveGrades(e){localStorage.setItem("treasurebox_grades",JSON.stringify(e))}function addSubject(){const e=getGradesFromInputs();e.push({subject:"新科目",score:0,credit:1}),document.getElementById("gradesList").innerHTML=renderGradeInputs(e),saveGrades(e)}function removeSubject(e){const t=getGradesFromInputs();t.length>1&&(t.splice(e,1),document.getElementById("gradesList").innerHTML=renderGradeInputs(t),saveGrades(t))}function clearGrades(){const e=getGradesFromInputs();e.forEach(e=>{e.score=0}),document.getElementById("gradesList").innerHTML=renderGradeInputs(e),saveGrades(e),document.getElementById("gradeResult").classList.add("hidden")}function calculateGrades(){const e=getGradesFromInputs();if(0===e.length)return;const t=e.reduce((e,t)=>e+t.score,0),o=t/e.length,n=e.reduce((e,t)=>e+t.credit,0),a=e.reduce((e,t)=>e+t.score*t.credit,0),s=n>0?a/n:0,r=e.reduce((e,t)=>t.score>e.score?t:e,e[0]),d=e.reduce((e,t)=>t.score<e.score?t:e,e[0]),l=e.filter(e=>e.score>=90).length,i=e.filter(e=>e.score>=80&&e.score<90).length,c=e.filter(e=>e.score>=70&&e.score<80).length,u=e.filter(e=>e.score>=60&&e.score<70).length,m=e.filter(e=>e.score<60).length;document.getElementById("averageScore").textContent=o.toFixed(2),document.getElementById("weightedAverage").textContent=s.toFixed(2),document.getElementById("highestSubject").textContent=`${r.subject} (${r.score}分)`,document.getElementById("lowestSubject").textContent=`${d.subject} (${d.score}分)`,document.getElementById("totalScore").textContent=t.toFixed(2);const p=`\n        <div class="flex items-center space-x-2">\n            <div class="w-16 text-sm">优秀(≥90)</div>\n            <div class="flex-1 bg-gray-200 rounded-full h-4 overflow-hidden">\n                <div class="bg-green-500 h-full" style="width: ${l/e.length*100}%"></div>\n            </div>\n            <div class="text-sm w-8 text-right">${l}科</div>\n        </div>\n        <div class="flex items-center space-x-2">\n            <div class="w-16 text-sm">良好(80-89)</div>\n            <div class="flex-1 bg-gray-200 rounded-full h-4 overflow-hidden">\n                <div class="bg-blue-500 h-full" style="width: ${i/e.length*100}%"></div>\n            </div>\n            <div class="text-sm w-8 text-right">${i}科</div>\n        </div>\n        <div class="flex items-center space-x-2">\n            <div class="w-16 text-sm">中等(70-79)</div>\n            <div class="flex-1 bg-gray-200 rounded-full h-4 overflow-hidden">\n                <div class="bg-yellow-500 h-full" style="width: ${c/e.length*100}%"></div>\n            </div>\n            <div class="text-sm w-8 text-right">${c}科</div>\n        </div>\n        <div class="flex items-center space-x-2">\n            <div class="w-16 text-sm">及格(60-69)</div>\n            <div class="flex-1 bg-gray-200 rounded-full h-4 overflow-hidden">\n                <div class="bg-orange-500 h-full" style="width: ${u/e.length*100}%"></div>\n            </div>\n            <div class="text-sm w-8 text-right">${u}科</div>\n        </div>\n        <div class="flex items-center space-x-2">\n            <div class="w-16 text-sm">不及格(<60)</div>\n            <div class="flex-1 bg-gray-200 rounded-full h-4 overflow-hidden">\n                <div class="bg-red-500 h-full" style="width: ${m/e.length*100}%"></div>\n            </div>\n            <div class="text-sm w-8 text-right">${m}科</div>\n        </div>\n    `;document.getElementById("gradeDistribution").innerHTML=p,document.getElementById("gradeResult").classList.remove("hidden"),saveGrades(e)}function playNotificationSound(){const e=new(window.AudioContext||window.webkitAudioContext),t=e.createOscillator(),o=e.createGain();t.connect(o),o.connect(e.destination),t.frequency.value=800,t.type="sine",o.gain.setValueAtTime(.3,e.currentTime),o.gain.exponentialRampToValueAtTime(.01,e.currentTime+.5),t.start(e.currentTime),t.stop(e.currentTime+.5)}function showNotification(e,t){"Notification"in window?"granted"===Notification.permission?new Notification(e,{body:t}):"denied"!==Notification.permission&&Notification.requestPermission().then(function(o){"granted"===o&&new Notification(e,{body:t})}):alert(`${e}: ${t}`)}function applyThemeClasses(){const e=document.documentElement.dataset.sidebarTheme||"win11",t=document.querySelector(".hero-section");if(t){t.classList.add(`${e}-hero-section`);const o=t.querySelector(".hero-title"),n=t.querySelector(".hero-description"),a=t.querySelector(".hero-tag");o&&o.classList.add(`${e}-hero-title`),n&&n.classList.add(`${e}-hero-description`),a&&a.classList.add(`${e}-hero-tag`)}const o=document.getElementById("toolModal");if(o){o.classList.add(`${e}-modal`);const t=o.querySelector(".modal-content"),n=o.querySelector(".modal-header"),a=o.querySelector(".modal-title"),s=o.querySelector(".close-modal"),r=o.querySelector(".modal-body");t&&t.classList.add(`${e}-modal-content`),n&&n.classList.add(`${e}-modal-header`),a&&a.classList.add(`${e}-modal-title`),s&&s.classList.add(`${e}-modal-close`),r&&r.classList.add(`${e}-modal-body`)}}function initToolCards(){const e=document.documentElement.dataset.sidebarTheme||"win11",t=document.querySelector(".tools-container");t&&t.classList.add(`${e}-tools-container`);const o=document.querySelector(".tools-grid");o&&o.classList.add(`${e}-tools-grid`);const n=document.querySelectorAll(".tool-card");0===n.length?createDefaultToolCards():n.forEach(t=>{t.classList.add(`${e}-tool-card`);const o=t.querySelector(".tool-icon"),n=t.querySelector(".tool-title"),a=t.querySelector(".tool-description"),s=t.querySelectorAll(".tool-category"),r=t.querySelector(".tool-button");o&&o.classList.add(`${e}-tool-icon`),n&&n.classList.add(`${e}-tool-title`),a&&a.classList.add(`${e}-tool-description`),s.forEach(t=>t.classList.add(`${e}-tool-category`)),r&&r.classList.add(`${e}-tool-button`)})}function createDefaultToolCards(){const e=document.querySelector(".tools-grid")||document.querySelector(".tools-container");if(!e)return;const t=document.documentElement.dataset.sidebarTheme||"win11";e.innerHTML="",[{id:"calculator",icon:"fas fa-calculator",title:"科学计算器",description:"30+计算方法，支持基础运算、科学计算、统计分析",categories:["基础运算","科学计算","统计分析"],functionName:"openCalculator()"},{id:"converter",icon:"fas fa-exchange-alt",title:"增强单位转换器",description:"支持12种分类，50+单位类型，智能转换",categories:["长度","重量","温度"],functionName:"openConverter()"},{id:"timer",icon:"fas fa-stopwatch",title:"计时器",description:"正计时和倒计时功能，适合学习计时使用",categories:["计时","学习"],functionName:"openTimer()"},{id:"random",icon:"fas fa-random",title:"随机数生成器",description:"生成指定范围内的随机数，适合抽签使用",categories:["随机","抽签"],functionName:"openRandomGenerator()"},{id:"countdown",icon:"fas fa-clock",title:"多功能倒计时器",description:"支持日期倒计时，学习规划好帮手",categories:["倒计时","规划"],functionName:"openCountdown()"},{id:"bmi",icon:"fas fa-heartbeat",title:"BMI计算器",description:"快速计算体质指数，关注健康成长",categories:["健康","计算"],functionName:"openBMI()"}].forEach(o=>{const n=document.createElement("div");n.className=`tool-card ${t}-tool-card win11-fade-in`,n.dataset.tool=o.id;let a="";o.categories&&o.categories.length>0&&(a=`<div class="tool-categories ${t}-tool-categories">`,o.categories.forEach(e=>{a+=`<span class="tool-category ${t}-tool-category">${e}</span>`}),a+="</div>"),n.innerHTML=`\n            <div class="tool-icon ${t}-tool-icon">\n                <i class="${o.icon}"></i>\n            </div>\n            <h3 class="tool-title ${t}-tool-title">${o.title}</h3>\n            <p class="tool-description ${t}-tool-description">${o.description}</p>\n            ${a}\n            <button class="tool-button ${t}-tool-button primary" onclick="${o.functionName}">\n                使用工具 <i class="fas fa-arrow-right"></i>\n            </button>\n        `,e.appendChild(n)})}function openBMI(){const e=document.documentElement.dataset.sidebarTheme||"win11",t="win10"===e?"win10-input":"win11-input";showToolModal("BMI计算器",`\n        <div class="bmi-calculator ${e}-bmi-calculator">\n            <div class="input-group">\n                <label for="weight">体重 (kg):</label>\n                <input type="number" id="weight" class="${t}" placeholder="请输入体重" min="1" step="0.1">\n            </div>\n            <div class="input-group">\n                <label for="height">身高 (cm):</label>\n                <input type="number" id="height" class="${t}" placeholder="请输入身高" min="1" step="0.1">\n            </div>\n            <button class="${"win10"===e?"win10-button":"win11-button"} primary" onclick="calculateBMI()">计算BMI</button>\n            <div id="bmi-result" class="${"win10"===e?"win10-result":"win11-result"}"></div>\n        </div>\n    `)}function calculateBMI(){const e=parseFloat(document.getElementById("weight").value),t=parseFloat(document.getElementById("height").value)/100,o=document.getElementById("bmi-result");document.documentElement.dataset.sidebarTheme;if(o.classList.add("scale-animation"),setTimeout(()=>o.classList.remove("scale-animation"),300),isNaN(e)||isNaN(t)||e<=0||t<=0)return void(o.innerHTML='<p class="error">请输入有效的体重和身高</p>');const n=e/(t*t);let a="",s="",r="";n<18.5?(a="偏瘦",s="建议适当增加营养，多进行力量训练。",r="#3b82f6"):n<24?(a="正常",s="体重正常，请继续保持健康的生活方式！",r="#10b981"):n<28?(a="偏胖",s="建议控制饮食，增加运动量。",r="#f59e0b"):(a="肥胖",s="建议咨询医生，制定科学的减重计划。",r="#ef4444"),o.innerHTML=`\n        <p>BMI值: <strong style="color: ${r}">${n.toFixed(1)}</strong></p>\n        <p>评价: <strong style="color: ${r}">${a}</strong></p>\n        <p>建议: ${s}</p>\n    `,playNotificationSound()}function initializeTheme(){const e=localStorage.getItem("sidebarTheme")||"win11";document.documentElement.dataset.sidebarTheme=e;document.querySelectorAll("link[data-theme-css]").forEach(e=>e.remove());const t=document.createElement("link");t.rel="stylesheet",t.href=`css/treasurebox/${e}.css`,t.dataset.themeCss="true",document.head.appendChild(t)}document.addEventListener("DOMContentLoaded",function(){initializeTheme(),initTreasureBox(),setTimeout(function(){const e=document.getElementById("page-loader");e&&(e.style.transition="opacity 0.5s ease-out",e.style.opacity="0",setTimeout(function(){e.style.display="none"},500))},300),applyThemeClasses(),initToolCards();const e=document.createElement("button");e.className="theme-toggle-button",e.style.position="fixed",e.style.bottom="20px",e.style.right="20px",e.style.padding="10px 20px",e.style.backgroundColor="#0078d7",e.style.color="white",e.style.border="none",e.style.borderRadius="4px",e.style.cursor="pointer",e.style.zIndex="9999",e.style.boxShadow="0 2px 5px rgba(0,0,0,0.2)"}),initializeTheme(),window.openCalculator=openCalculator,window.openConverter=openConverter,window.openTimer=openTimer,window.openRandomGenerator=openRandomGenerator,window.openCountdown=openCountdown,window.openBMI=openBMI,window.openPomodoro=openPomodoro,window.openTodoList=openTodoList,window.openGradeCalculator=openGradeCalculator,window.closeToolModal=closeToolModal,window.appendToCalc=appendToCalc,window.clearCalc=clearCalc,window.calculate=calculate,window.updateConverterUnits=updateConverterUnits,window.convertUnits=convertUnits,window.startTimer=startTimer,window.pauseTimer=pauseTimer,window.resetTimer=resetTimer,window.updateTimerDisplay=updateTimerDisplay,window.startCountdown=startCountdown,window.updateCountdownDisplay=updateCountdownDisplay,window.generateRandom=generateRandom,window.calculateCountdown=calculateCountdown,window.calculateBMI=calculateBMI,window.startPomodoro=startPomodoro,window.pausePomodoro=pausePomodoro,window.resetPomodoro=resetPomodoro,window.addTodo=addTodo,window.toggleTodo=toggleTodo,window.deleteTodo=deleteTodo,window.filterTodos=filterTodos,window.clearCompleted=clearCompleted,window.addSubject=addSubject,window.removeSubject=removeSubject,window.updateGradeSubject=updateGradeSubject,window.updateGradeScore=updateGradeScore,window.updateGradeCredit=updateGradeCredit,window.clearGrades=clearGrades,window.calculateGrades=calculateGrades,window.sendEcho=sendEcho,window.showRandomEcho=showRandomEcho,window.deleteEcho=deleteEcho,window.startTypingEffect=startTypingEffect,window.initializeTheme=initializeTheme;