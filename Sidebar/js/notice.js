let notifications=[];async function parseMarkdownArticle(t){try{const e=await fetch(`../article/md/${t}`);if(!e.ok)return null;const n=(await e.text()).split("\n");let i=t.replace(".md",""),a="",r="JGL STUDIO",o=1;for(const t of n)t.startsWith("# ")?i=t.slice(2).trim():t.includes("发布日期：")?a=t.replace("> 发布日期：","").trim():t.includes("发布人：")&&(r=t.replace("> 发布人：","").trim());let c="";for(const t of n)if(!t.startsWith("#")&&!t.startsWith(">")&&"---"!==t.trim()&&""!==t.trim()&&(c+=t+" ",c.length>50))break;return i.includes("分数")||i.includes("成绩")?o=2:(i.includes("活动")||i.includes("表彰"))&&(o=3),{id:t.replace(".md",""),title:i,content:c.trim()+"...",date:a,level:o,author:r}}catch(t){return null}}async function loadMarkdownArticles(){try{let t;try{const e=await fetch("../config/article.json");if(!e.ok)throw new Error("Failed to fetch article.json");t=(await e.json()).articleFiles||[]}catch(e){t=["202510122130.md","202510122239.md"]}const e=[];for(const n of t){const t=await parseMarkdownArticle(n);t&&e.push(t)}return e.sort((t,e)=>{const n=new Date(t.date.replace(/年/g,"-").replace(/月/g,"-").replace(/日/g,""));return new Date(e.date.replace(/年/g,"-").replace(/月/g,"-").replace(/日/g,""))-n}),notifications=e,e}catch(t){return[]}}function getLevelMetadata(t){const e={1:{name:"普通通知",icon:"fa-file-text",color:"blue"},2:{name:"报告/公示",icon:"fa-file-alt",color:"green"},3:{name:"活动/表彰",icon:"fa-star",color:"yellow"}};return e[t]||e[1]}function sortByDate(t,e){return new Date(e.date)-new Date(t.date)}function renderNotifications(t="all"){const e=document.getElementById("notifications-container");if(!e)return;const n=document.body.classList.contains("win10"),i=notifications.filter(e=>"all"===t||e.level.toString()===t);i.sort(sortByDate),e.innerHTML="",i.forEach((t,i)=>{const a=getLevelMetadata(t.level),r=n?"notification-card":"notice-card",o=document.createElement("div");o.className=`${r} ${n?"priority-"+t.level:""}`,o.setAttribute("data-aos","fade-up"),o.setAttribute("data-aos-delay",(100*i).toString()),o.innerHTML=`\n            <div class="flex items-start justify-between mb-4">\n                <div class="flex items-center space-x-3">\n                    <div class="w-10 h-10 rounded-full flex items-center justify-center" style="background-color: var(--win11-${a.color}-light-bg, rgba(0, 120, 212, 0.1));">\n                        <i class="fas ${a.icon}" style="color: var(--win11-${a.color}, var(--win11-primary));"></i>\n                    </div>\n                    <div>\n                        <h3 class="text-lg font-semibold" style="color: var(--win11-text-primary);">${t.title}</h3>\n                        <div class="flex items-center space-x-2 text-sm" style="color: var(--win11-text-secondary);">\n                            <span>${t.author}</span>\n                            <span>•</span>\n                            <span>${t.date}</span>\n                        </div>\n                    </div>\n                </div>\n                <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium" style="background-color: var(--win11-${a.color}-light-bg, rgba(0, 120, 212, 0.1)); color: var(--win11-${a.color}, var(--win11-primary));">\n                    ${a.name}\n                </span>\n            </div>\n            <p class="mb-4 leading-relaxed" style="color: var(--win11-text-primary);">${t.content}</p>\n            <div class="flex items-center justify-between text-sm">\n                <div class="flex items-center space-x-4">\n                </div>\n                <button class="font-medium transition-colors duration-200 px-4 py-2 rounded" style="background-color: var(--win11-primary); color: var(--win11-text-white);" onclick="openArticle('${t.id}')">\n                    查看详情 <i class="fas fa-arrow-right ml-1"></i>\n                </button>\n            </div>\n        `,e.appendChild(o)}),updateStatistics(i.length)}function updateStatistics(t){const e=document.getElementById("notification-count");e&&animateNumber(e,parseInt(e.textContent)||0,t)}function animateNumber(t,e,n,i=500){const a=performance.now();requestAnimationFrame(function r(o){const c=o-a,l=Math.min(c/i,1),s=1-Math.pow(1-l,4),d=Math.floor(e+(n-e)*s);t.textContent=d,l<1&&requestAnimationFrame(r)})}function viewNotificationDetail(t){const e=notifications.find(e=>e.id===t);e&&alert(`通知详情：\n标题：${e.title}\n内容：${e.content}\n日期：${e.date}\n发布人：${e.author}`)}function openArticle(t){window.location.href=`../article/notice-template.html?md=md/${t}.md`}async function initNoticePage(){"undefined"!=typeof AOS&&AOS.init({duration:800,once:!0,offset:100}),await loadMarkdownArticles();const t=document.querySelectorAll(".filter-btn");t.forEach(e=>{const n=e.getAttribute("data-filter");let i="primary",a="text-primary/80",r="bg-primary/10";"1"===n?(i="blue",a="text-blue-700",r="bg-blue-100"):"2"===n?(i="green",a="text-green-700",r="bg-green-100"):"3"===n&&(i="yellow",a="text-yellow-700",r="bg-yellow-100"),e.classList.add(a,r,"transition-all","duration-300"),e.classList.remove("bg-gray-200","text-gray-700"),e.addEventListener("click",function(){t.forEach(t=>{const e=t.getAttribute("data-filter");let n,i,a;"1"===e?(n="blue",i="text-blue-700",a="bg-blue-100"):"2"===e?(n="green",i="text-green-700",a="bg-green-100"):"3"===e?(n="yellow",i="text-yellow-700",a="bg-yellow-100"):(n="primary",i="text-primary/80",a="bg-primary/10"),t.classList.remove(`bg-${n}`,"text-white"),t.classList.add(i,a)}),this.classList.remove(a,r),this.classList.add(`bg-${i}`,"text-white"),renderNotifications(n)})}),renderNotifications("all")}function openArticleModal(t){}function closeArticleModal(){}document.addEventListener("DOMContentLoaded",function(){document.body.classList.contains("theme-rendering")?window.addEventListener("sidebar.theme.render.ready",function(){initNoticePage()}):initNoticePage()});