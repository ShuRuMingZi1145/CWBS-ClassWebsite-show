<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>关于我们 - 贯通2501班 班级网站</title><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" rel="stylesheet"><link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet"><script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet"><link rel="stylesheet" href="../css/base.css"><script src="../js/site-config.js"></script><script src="css/theme-loader.js"></script></head><body class="main-body custom-scrollbar" style="visibility: hidden;"><div id="page-loader" style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: #f3f2f1; display: flex; align-items: center; justify-content: center; z-index: 9999;"><div style="text-align: center;"><div style="font-size: 3rem; margin-bottom: 1rem;"><i class="fas fa-info-circle"></i></div><p style="font-size: 1.2rem; color: #6e6e6e;">加载中...</p></div></div><nav id="navbar" class="navbar"><div class="container"><div class="navbar-content"><div class="navbar-brand"><div class="logo-container"><div class="logo animate-glow"><i class="fas fa-info-circle"></i></div><div class="logo-status"></div></div><div class="brand-info"><span class="site-name">贯通2501班</span> <span class="site-description">关于我们</span></div></div><div class="navbar-menu"><a href="../index.html" class="win11-navbar-link nav-home">首页</a> <a href="../index.html#class-info" class="win11-navbar-link">班级介绍</a> <a href="notice.html" class="win11-navbar-link">班级动态</a> <a href="rules.html" class="win11-navbar-link">班级规章</a> <a href="timetable.html" class="win11-navbar-link">课程表</a> <a href="classstyle.html" class="win11-navbar-link nav-classstyle">班级风采</a> <a href="treasurebox.html" class="win11-navbar-link nav-treasurebox">百宝箱</a> <a href="#" class="win11-navbar-link nav-about">关于我们</a></div><div class="navbar-actions"><button class="win11-btn-text notification-btn"><i class="fas fa-bell"></i> <span class="notification-dot"></span></button> <button class="win11-btn-text mobile-menu-btn" id="mobile-menu-button"><i class="fas fa-bars"></i></button></div></div></div><div id="mobile-menu" class="mobile-menu win11-card"><div class="mobile-menu-content"><a href="../index.html" class="win11-navbar-link nav-home">首页</a> <a href="../index.html#class-info" class="win11-navbar-link">班级介绍</a> <a href="notice.html" class="win11-navbar-link">班级动态</a> <a href="rules.html" class="win11-navbar-link">班级规章</a> <a href="timetable.html" class="win11-navbar-link">课程表</a> <a href="classstyle.html" class="win11-navbar-link nav-classstyle">班级风采</a> <a href="treasurebox.html" class="win11-navbar-link nav-treasurebox">百宝箱</a> <a href="#" class="win11-navbar-link nav-about">关于我们</a></div></div></nav><section class="pt-56 pb-15 md:pt-72 md:pb-15 px-4 sm:px-4 lg:px-6" style="position: relative; z-index: 1; margin-top: 80px;"><div class="container mx-auto"><div class="max-w-4xl mx-auto text-center glass-card p-8 rounded-2xl" data-aos="fade-up"><h1 id="page-title" class="text-4xl md:text-5xl lg:text-6xl font-bold mb-6 bg-gradient-to-r from-primary to-accent text-gradient"></h1><p class="text-xl md:text-2xl text-gray-600 mb-8 leading-relaxed">了解我们班级的创建背景、发展历程和团队理念</p><div class="flex justify-center space-x-4"><div class="inline-flex items-center px-4 py-2 bg-primary/10 rounded-full text-primary"><i class="fas fa-users mr-2"></i> <span class="font-medium">团队介绍</span></div><div class="inline-flex items-center px-4 py-2 bg-secondary/10 rounded-full text-secondary"><i class="fas fa-heart mr-2"></i> <span class="font-medium">班级理念</span></div></div></div></div></section><section class="py-8 px-4 sm:px-6 lg:px-8"><div class="container mx-auto"><div class="max-w-4xl mx-auto"><div id="content" class="glass-effect rounded-xl p-8" data-aos="fade-up" data-aos-delay="100"></div></div></div></section><footer class="bg-dark text-white py-6"><div class="container mx-auto px-4"><div style="display: flex; flex-direction: row; flex-wrap: wrap;"><div style="flex: 1 1 200px; margin-bottom: 20px; padding: 0 10px;"><div class="flex items-center mb-4"><div class="w-10 h-10 rounded-lg bg-gradient-to-r from-primary to-accent flex items-center justify-center"><i class="fas fa-info-circle text-white text-xl"></i></div><div class="ml-3"><span class="block text-sm font-semibold text-white">贯通2501班</span> <span class="block text-xs text-gray-400">班级网站</span></div></div><p class="text-gray-400 text-sm">专业的班级管理与交流平台，助力班级建设与同学成长。</p></div><div style="flex: 1 1 200px; margin-bottom: 20px; padding: 0 10px;"><h4 class="text-lg font-semibold mb-4">快速链接</h4><ul class="space-y-2 modern-list"><li><a href="../index.html" class="text-gray-400 hover:text-white transition-colors duration-200">首页</a></li><li><a href="../index.html#class-info" class="text-gray-400 hover:text-white transition-colors duration-200">班级介绍</a></li><li><a href="../index.html#recent-activities" class="text-gray-400 hover:text-white transition-colors duration-200">班级动态</a></li><li><a href="Rules.html" class="text-gray-400 hover:text-white transition-colors duration-200">班级规章</a></li><li><a href="ClassStyle.html" class="text-gray-400 hover:text-white transition-colors duration-200">班级风采</a></li><li><a href="treasurebox.html" class="text-gray-400 hover:text-white transition-colors duration-200">百宝箱</a></li><li><a href="#" class="text-gray-400 hover:text-white transition-colors duration-200">关于我们</a></li></ul></div><div style="flex: 1 1 200px; margin-bottom: 20px; padding: 0 10px;"><h4 class="text-lg font-semibold mb-4">资源中心</h4><ul class="space-y-2 modern-list"><li><a href="../index.html" class="text-gray-400 hover:text-white transition-colors duration-200">班级相册</a></li><li><a href="../index.html" class="text-gray-400 hover:text-white transition-colors duration-200">学习资源</a></li><li><a href="../index.html" class="text-gray-400 hover:text-white transition-colors duration-200">活动记录</a></li><li><a href="../index.html" class="text-gray-400 hover:text-white transition-colors duration-200">荣誉展示</a></li><li><a href="notice.html" class="text-gray-400 hover:text-white transition-colors duration-200">通知公告</a></li></ul></div><div style="flex: 1 1 200px; margin-bottom: 20px; padding: 0 10px;"><h4 class="text-lg font-semibold mb-4">联系信息</h4><ul class="space-y-2 modern-list"><li class="flex items-center"><i class="fas fa-envelope text-gray-400 mr-2"></i> <span class="text-gray-400">联系管理员</span></li></ul></div></div><div class="border-t border-gray-800 mt-4 pt-4 text-center"><p class="text-gray-400 text-sm footer-copyright">© 2024 JGL STUDIO. 保留所有权利。</p></div></div></footer><button id="back-to-top" class="fixed bottom-8 right-8 bg-primary hover:bg-primary/90 text-white w-12 h-12 rounded-full flex items-center justify-center shadow-lg transition-all duration-300 opacity-0 invisible"><i class="fas fa-arrow-up"></i></button><script>// 页面加载后初始化AOS
        window.addEventListener('sidebar.theme.render.ready', function() {
            console.log('主题渲染完成，初始化班级风采页面...');
            
            // 隐藏加载中占位符
            const pageLoader = document.getElementById('page-loader');
            if (pageLoader) {
                pageLoader.style.display = 'none';
            }
            
            // 显示页面内容
            const pageContent = document.querySelector('body');
            if (pageContent) {
                pageContent.style.visibility = 'visible';
            }
            
            AOS.init({
                duration: 1000,
                once: true
            });
            
            // 设置页面标题
            document.getElementById('page-title').textContent = '了解我们的班级';
            
            // 加载内容
        loadAboutContent();
        
        // 初始化移动端菜单功能
        initMobileMenu();
        
        // 初始化返回顶部按钮
        initBackToTop();
        
        console.log('关于我们页面初始化完成');
    });
    
    // 移动端菜单功能
    function initMobileMenu() {
        const mobileMenuBtn = document.getElementById('mobile-menu-button');
        const mobileMenu = document.getElementById('mobile-menu');
        
        if (mobileMenuBtn && mobileMenu) {
            mobileMenuBtn.addEventListener('click', function() {
                const isOpen = mobileMenu.style.display === 'block';
                mobileMenu.style.display = isOpen ? 'none' : 'block';
                
                // 添加动画效果
                if (!isOpen) {
                    mobileMenu.style.opacity = '0';
                    mobileMenu.style.transform = 'translateY(-10px)';
                    
                    setTimeout(() => {
                        mobileMenu.style.opacity = '1';
                        mobileMenu.style.transform = 'translateY(0)';
                    }, 10);
                }
            });
            
            // 点击菜单外区域关闭菜单
            document.addEventListener('click', function(event) {
                if (!mobileMenu.contains(event.target) && !mobileMenuBtn.contains(event.target)) {
                    mobileMenu.style.display = 'none';
                }
            });
        }
    }
    
    // 返回顶部按钮功能
    function initBackToTop() {
        const backToTopBtn = document.getElementById('back-to-top');
        
        if (backToTopBtn) {
            // 监听滚动事件
            window.addEventListener('scroll', function() {
                if (window.pageYOffset > 300) {
                    backToTopBtn.classList.remove('opacity-0', 'invisible');
                    backToTopBtn.classList.add('opacity-100', 'visible');
                } else {
                    backToTopBtn.classList.remove('opacity-100', 'visible');
                    backToTopBtn.classList.add('opacity-0', 'invisible');
                }
            });
            
            // 点击返回顶部
            backToTopBtn.addEventListener('click', function() {
                window.scrollTo({
                    top: 0,
                    behavior: 'smooth'
                });
            });
        }
    }
    
    function loadAboutContent() {
            const contentElement = document.getElementById('content');
            if (contentElement) {
                contentElement.innerHTML = `
                    <style>
                    .media-gallery{margin-top:12px}.date-section{margin-bottom:24px}.date-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}.media-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(140px,1fr));gap:10px}.media-item{position:relative;overflow:hidden;border-radius:12px;background:#fff;box-shadow:0 1px 4px rgba(0,0,0,.08)}.media-item img,.media-item video{width:100%;height:120px;object-fit:cover;display:block}.media-meta{padding:6px 8px;font-size:12px;color:#666}.media-actions{position:absolute;top:6px;right:6px;display:flex;gap:6px}.media-actions button{background:rgba(0,0,0,.5);color:#fff;border:none;padding:4px 6px;border-radius:6px;cursor:pointer}.upload-btn-fixed{position:fixed;right:24px;bottom:24px;z-index:1200;width:56px;height:56px;border-radius:50%;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,#4f46e5,#06b6d4);color:#fff;box-shadow:0 8px 24px rgba(79,70,229,.18);border:none;cursor:pointer}.upload-btn-fixed i{font-size:18px}.hidden-file-input{display:none}.no-media{padding:28px;text-align:center;color:#666}
                    </style>
                    <div class="space-y-8">
                        <div class="glass-card p-6 rounded-xl">
                            <h2 class="text-2xl font-bold mb-4">班级风采</h2>
                            <p class="mb-4">在此处展示班级照片与视频，按日期分组。</p>
                            <div id="gallery" class="media-gallery"></div>
                        </div>
                    </div>
                    <input id="file-input" class="hidden-file-input" type="file" accept="image/*,video/*" multiple>
                    <button id="upload-btn" class="upload-btn-fixed" title="上传照片/视频"><i class="fas fa-upload"></i></button>
                `;
            }
            initGallery();
        }

        // 远程存储配置
        const REMOTE_BASE = 'http://103.40.14.81:55618';
        const REMOTE_DIR = '/list/all/CWBS-ClassWebsite-show';
        // 如需鉴权，请把 token 填入下面变量（不带 Bearer 前缀，按目标 API 要求）
        const AUTH_TOKEN = '';

        let galleryItems = [];

        async function initGallery() {
            const uploadBtn = document.getElementById('upload-btn');
            const fileInput = document.getElementById('file-input');
            // 先从服务器加载持久化的画廊项
            let serverItems = [];
            try {
                // 使用文件列表 API（POST /api/fs/list）
                const listUrl = REMOTE_BASE + '/api/fs/list';
                const headers = { 'Content-Type': 'application/json' };
                if (AUTH_TOKEN) headers['Authorization'] = AUTH_TOKEN;
                const resp = await fetch(listUrl, { method: 'POST', headers, body: JSON.stringify({ path: REMOTE_DIR, page: 1, per_page: 200 }) });
                if (resp.ok) {
                    const j = await resp.json();
                    // 兼容不同返回结构：优先取 data.content
                    const content = (j && j.data && j.data.content) ? j.data.content : (j && j.content) ? j.content : (Array.isArray(j) ? j : []);
                    serverItems = Array.isArray(content) ? content.map(normalizeRemoteItem) : [];
                }
            } catch (e) {
                console.warn('无法加载服务器画廊，使用本地缓存', e);
            }
            galleryItems = serverItems;
            renderGallery();

            if (uploadBtn && fileInput) {
                uploadBtn.addEventListener('click', () => fileInput.click());
                fileInput.addEventListener('change', (e) => {
                    const files = Array.from(e.target.files || []);
                    if (files.length) handleFiles(files);
                    fileInput.value = '';
                });
            }
        }
        // 不再使用 localStorage 回退；全部使用远程 API

        async function handleFiles(files) {
            for (const f of files) {
                try {
                    // 上传到远程文件系统（PUT 流式）
                    await uploadToRemote(f);
                } catch (e) {
                    console.error('上传失败', e);
                    alert('上传失败: ' + (e.message || e));
                }
            }
            // 上传完成后刷新列表
            await initGallery();
        }

        // PUT 二进制到 /api/fs/put，要求 header: path
        async function uploadToRemote(file) {
            const putUrl = REMOTE_BASE + '/api/fs/put';
            const headers = {};
            // 目标路径（根据服务要求调整），确保以 / 开头
            const targetPath = (REMOTE_DIR.endsWith('/') ? REMOTE_DIR.slice(0, -1) : REMOTE_DIR) + '/' + file.name;
            headers['path'] = targetPath;
            headers['Last-Modified'] = String(file.lastModified || Date.now());
            headers['As-Task'] = 'false';
            if (AUTH_TOKEN) headers['Authorization'] = AUTH_TOKEN;
            const resp = await fetch(putUrl, { method: 'PUT', headers, body: file });
            if (!resp.ok) {
                const txt = await resp.text().catch(()=>'');
                throw new Error('upload failed: ' + resp.status + ' ' + txt);
            }
            // 有些实现返回 JSON 包含 code/message/data；我们不依赖于它，随后通过 list 刷新
            return resp;
        }

        function readFileAsDataURL(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result);
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }

        function renderGallery() {
            const gallery = document.getElementById('gallery');
            if (!gallery) return;
            if (!galleryItems || galleryItems.length === 0) {
                gallery.innerHTML = '<div class="no-media">暂无照片或视频，点击右下角上传</div>';
                return;
            }
            const groups = {};
            galleryItems.forEach(item => { groups[item.date || item.modified?.split('T')?.[0] || '未知日期'] = groups[item.date || item.modified?.split('T')?.[0] || '未知日期'] || []; groups[item.date || item.modified?.split('T')?.[0] || '未知日期'].push(item); });
            const dates = Object.keys(groups).sort((a,b) => b.localeCompare(a));
            let html = '';
            dates.forEach(date => {
                html += `<div class="date-section"><div class="date-header"><strong>${date}</strong><span class="text-sm text-gray-500">${groups[date].length} 项</span></div><div class="media-grid">`;
                groups[date].forEach(item => {
                    const isVideo = (item.type || '').startsWith('video');
                    const src = item.url || buildFileUrl(item) || '';
                    html += `<div class="media-item" data-id="${item.id || item.path || item.name}">`;
                    if (isVideo) html += `<video controls src="${src}"></video>`;
                    else html += `<img src="${src}" alt="${item.name || item.path}">`;
                    html += `<div class="media-actions"><button data-action="remove" title="删除"><i class="fas fa-trash"></i></button></div>`;
                    html += `<div class="media-meta">${item.name || item.path}</div></div>`;
                });
                html += `</div></div>`;
            });
            gallery.innerHTML = html;
            // bind remove
            gallery.querySelectorAll('[data-action="remove"]').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const id = e.target.closest('.media-item').getAttribute('data-id');
                    removeItem(id);
                });
            });
        }

        async function removeItem(id) {
            const item = galleryItems.find(i => i.id === id);
            if (!item) return;
            // 如果是服务器项，先请求删除
            try {
                // 使用 /api/fs/delete 或 /api/media/:id 风格均尝试
                const headers = {};
                if (AUTH_TOKEN) headers['Authorization'] = AUTH_TOKEN;
                // 如果 item.path 可用，尝试 POST /api/fs/delete
                if (item.path) {
                    const delResp = await fetch(REMOTE_BASE + '/api/fs/delete', { method: 'POST', headers: Object.assign({ 'Content-Type': 'application/json' }, headers), body: JSON.stringify({ path: item.path }) });
                    if (delResp.ok) {
                        // 删除成功
                    } else {
                        // 尝试 DELETE /api/media/:id
                        await fetch(REMOTE_BASE + '/api/media/' + encodeURIComponent(id), { method: 'DELETE', headers });
                    }
                } else if (item.id) {
                    await fetch(REMOTE_BASE + '/api/media/' + encodeURIComponent(id), { method: 'DELETE', headers });
                }
            } catch (e) { console.warn('删除服务器文件失败', e); }
            galleryItems = galleryItems.filter(i => (i.id || i.path || i.name) !== id);
            renderGallery();
        }

        function normalizeRemoteItem(raw) {
            // 根据常见的 /api/fs/list 返回结构构造通用项
            return {
                id: raw.id || (raw.name ? encodeURIComponent(raw.name) : undefined),
                name: raw.name || raw.path || '',
                type: raw.type || (raw.name && raw.name.match(/\.(mp4|webm|ogg)$/i) ? 'video/*' : 'image/*'),
                url: raw.url || undefined,
                path: raw.path || undefined,
                modified: raw.modified || raw.updated || undefined,
                sign: raw.sign || raw.hash || undefined
            };
        }

        function buildFileUrl(item) {
            if (!item) return null;
            // 优先使用 item.url
            if (item.url && item.url.startsWith('http')) return item.url;
            // 如果有 sign 和 path，尝试 /api/fs/get?path=...&sign=...
            if (item.path && item.sign) return REMOTE_BASE + '/api/fs/get?path=' + encodeURIComponent(item.path) + '&sign=' + encodeURIComponent(item.sign);
            if (item.path) return REMOTE_BASE + '/api/fs/get?path=' + encodeURIComponent(item.path);
            return null;
        }
</script></body></html>
