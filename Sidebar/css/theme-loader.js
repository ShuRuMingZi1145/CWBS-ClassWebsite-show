class SidebarThemeLoader{constructor(){this.siteConfig=null,this.currentTheme="win11",this.loadingComplete=!1,this.pageType=this.detectPageType()}async initialize(){try{await this.waitForSiteConfig(),this.loadThemeFromConfig(),this.loadBaseThemeCSS(),this.loadPageSpecificThemeCSS(),this.applyThemeClass(),this.loadingComplete=!0,this.triggerThemeLoadedEvent()}catch(e){this.fallbackToDefaultTheme(),this.notifyRenderReady()}}detectPageType(){const e=window.location.pathname;return e.includes("about.html")?"about":e.includes("notice.html")?"notice":e.includes("Rules.html")?"rules":e.includes("treasurebox.html")?"treasurebox":"default"}async waitForSiteConfig(){return new Promise((e,t)=>{if(window.siteConfigLoaded&&"function"==typeof window.siteConfigLoaded.then)window.siteConfigLoaded.then(()=>{window.siteConfig?(this.siteConfig=window.siteConfig,e()):t(new Error("配置Promise解析但配置对象不存在"))}).catch(e=>{t(e)});else{const t=()=>{window.siteConfig&&(this.siteConfig=window.siteConfig,window.removeEventListener("site.config.loaded",t),e())};window.addEventListener("site.config.loaded",t);const i=20;let s=0;const n=()=>{s++,window.siteConfig&&window.siteConfig.loaded?(this.siteConfig=window.siteConfig,window.removeEventListener("site.config.loaded",t),e()):s>=i?(window.removeEventListener("site.config.loaded",t),e()):setTimeout(n,100)};window.siteConfig&&window.siteConfig.loaded?t():n()}})}loadThemeFromConfig(){try{if(this.siteConfig&&"function"==typeof this.siteConfig.getUIStyle){const e=this.siteConfig.getUIStyle().toLowerCase();["win10","win11"].includes(e)?this.currentTheme=e:this.currentTheme="win11"}else if(this.siteConfig&&this.siteConfig.site&&this.siteConfig.site.uiStyle){const e=this.siteConfig.site.uiStyle.toLowerCase();["win10","win11"].includes(e)?this.currentTheme=e:this.currentTheme="win11"}else this.currentTheme="win11"}catch(e){}}loadBaseThemeCSS(){this.ensureBaseCSSLoaded(),this.removeExistingBaseThemeCSS();const e=document.createElement("link");e.id="sidebar-theme-css",e.rel="stylesheet",e.href=`../css/${this.currentTheme}.css`,e.async=!1,document.head.appendChild(e),e.onload=()=>{this.applyThemeClass()},e.onerror=()=>{}}loadPageSpecificThemeCSS(){if("default"===this.pageType)return void this.notifyRenderReady();const e=document.getElementById(`sidebar-${this.pageType}-theme-css`);e&&e.remove();const t=document.createElement("link");t.id=`sidebar-${this.pageType}-theme-css`,t.rel="stylesheet",t.href=`css/${this.pageType}/${this.currentTheme}.css`,t.async=!1,document.head.appendChild(t),t.onload=()=>{this.applyPageSpecificThemeClass(),this.notifyRenderReady()},t.onerror=()=>{this.notifyRenderReady()}}ensureBaseCSSLoaded(){let e=document.getElementById("sidebar-base-css");e||(e=document.createElement("link"),e.id="sidebar-base-css",e.rel="stylesheet",e.href="../css/base.css",e.async=!1,document.head.appendChild(e))}removeExistingBaseThemeCSS(){const e=document.getElementById("sidebar-theme-css");e&&e.remove()}applyThemeClass(){document.body.classList.remove("win10","win11","win10-sidebar","win11-sidebar"),document.body.classList.add(this.currentTheme),document.body.classList.add(`${this.currentTheme}-sidebar`);const e=document.getElementById("navbar");e&&(e.classList.remove("win10-navbar","win11-navbar","win10-sidebar-navbar","win11-sidebar-navbar"),e.classList.add(`${this.currentTheme}-navbar`),e.classList.add(`${this.currentTheme}-sidebar-navbar`)),this.replaceThemeClassNames()}applyPageSpecificThemeClass(){if("treasurebox"===this.pageType){const e=document.querySelector(".hero-section");e&&(e.classList.remove("win10-hero","win11-hero"),e.classList.add(`${this.currentTheme}-hero`));document.querySelectorAll(".tool-card").forEach(e=>{e.classList.remove("win10-tool-card","win11-tool-card"),e.classList.add(`${this.currentTheme}-tool-card`)})}}replaceThemeClassNames(){const e="win10"===this.currentTheme?"win11":"win10",t=this.currentTheme,i=document.querySelectorAll(`[class*="${e}-"]`);i.forEach(i=>{const s=i.className.split(" ").map(i=>i.startsWith(`${e}-`)?i.replace(`${e}-`,`${t}-`):i);i.className=s.join(" ")})}fallbackToDefaultTheme(){this.currentTheme="win11",this.loadBaseThemeCSS(),this.loadPageSpecificThemeCSS(),this.applyThemeClass()}notifyRenderReady(){const e=new CustomEvent("sidebar.theme.render.ready",{detail:{theme:this.currentTheme,pageType:this.pageType}});window.dispatchEvent(e)}triggerThemeLoadedEvent(){const e=new CustomEvent("sidebar.theme.loaded",{detail:{theme:this.currentTheme,pageType:this.pageType,timestamp:Date.now()}});window.dispatchEvent(e)}getCurrentTheme(){return this.currentTheme}getPageType(){return this.pageType}}const sidebarThemeLoader=new SidebarThemeLoader;function initSidebarThemeLoader(){let e="win11";try{e=window.siteConfig?.getUIStyle?.()||window.siteConfig?.site?.uiStyle||"win11",e=e.toLowerCase(),["win10","win11"].includes(e)||(e="win11")}catch(e){}document.body.classList.add(e),document.body.classList.add(`${e}-sidebar`),sidebarThemeLoader.initialize()}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{setTimeout(initSidebarThemeLoader,0)}):setTimeout(initSidebarThemeLoader,0),window.sidebarThemeLoader=sidebarThemeLoader,window.themeLoader=sidebarThemeLoader;